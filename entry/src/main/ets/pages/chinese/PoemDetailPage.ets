import router from '@ohos.router';
import promptAction from '@ohos.promptAction';
import { TextReader, TextReaderIcon, ReadStateCode } from '@kit.SpeechKit';
import common from '@ohos.app.ability.common';
import { BusinessError } from '@kit.BasicServicesKit';

// 定义唐诗接口
interface Poem {
  id: number;
  title: string;
  author: string;
  content: string;
  pinyin?: string; // 添加拼音字段
}

// 定义句子接口
interface Sentence {
  sentence: string;
  pinyin: string;
}

// 定义字符拼音对接口
interface CharPinyinPair {
  char: string;
  pinyin: string;
}

// 定义参数接口
interface PageParams {
  poem?: string;
}

@Entry
@Component
export struct PoemDetailPage {
  @State poem: Poem = {
    id: 0,
    title: '',
    author: '',
    content: '',
    pinyin: '' // 添加拼音字段
  };
  // 添加TTS相关状态
  @State isPlaying: boolean = false;

  // 不再创建TextReader实例，而是使用静态方法


  aboutToAppear(): void {
    // 获取从上一个页面传递过来的诗歌数据
    // 使用 JSON 方法安全地处理参数
    try {
      const paramsStr = JSON.stringify(router.getParams());
      if (paramsStr && paramsStr !== '{}') {
        const params: PageParams = JSON.parse(paramsStr);
        if (params.poem) {
          this.poem = JSON.parse(params.poem);
        }
      }
    } catch (e) {
      console.log('参数解析失败:', e);
    }

    // 初始化TTS客户端
    this.initTextReader();
  }

  aboutToDisappear(): void {
    // 页面销毁时停止朗读
    if (this.isPlaying) {
      TextReader.stop();
    }

  }

  // 初始化TextReader
  private initTextReader(): void {
    try {
      // 创建朗读参数
      const readerParam: TextReader.ReaderParam = {
        isVoiceBrandVisible: true,
        businessBrandInfo: {
          panelName: '小艺朗读',
          panelIcon: $r('app.media.startIcon')
        }
      ,
        keepBackgroundRunning: true
      };

      // 初始化TextReader
      TextReader.init(getContext(), readerParam).then(() => {
        console.log('TextReader初始化成功');
      }).catch((error: Error) => {
        console.error('TextReader初始化失败:', error);
      });

      // 监听朗读状态变化
      TextReader.on('stateChange', (state: TextReader.ReadState) => {
        console.log('朗读状态变化:', state);
        switch (state.state) {
          case ReadStateCode.PLAYING:
            this.isPlaying = true;
            break;
          case ReadStateCode.PAUSED:
          case ReadStateCode.WAITING:
          case ReadStateCode.COMPLETED:
            this.isPlaying = false;
            break;
        }
      });
    } catch (error) {
      const e: Error = error as Error;
      console.error('初始化TextReader时发生错误:', e);
    }
  }

  // 朗读/暂停朗读
  private togglePlay(): void {
    try {
      if (this.isPlaying) {
        // 暂停朗读
        TextReader.pause();
        this.isPlaying = false;
      } else {
        // 如果没有在朗读，则开始朗读
        this.startPlay();
      }
    } catch (error) {
      const e: Error = error as Error;
      console.error('切换朗读状态时发生错误:', e);
    }
  }

  // 开始朗读
  private startPlay(): void {
    try {
      // 创建朗读内容
      const readInfo: TextReader.ReadInfo = {
        id: `poem_${this.poem.id}`,
        title: {
          text: this.poem.title,
          isClickable: false
        },
        bodyInfo: `${this.poem.title}，作者：${this.poem.author}。${this.poem.content}`
      };

      // 开始朗读
      TextReader.start([readInfo]).then(() => {
        console.log('开始朗读');
        this.isPlaying = true;
      }).catch((error: Error) => {
        console.error('朗读失败:', error);
        promptAction.showToast({ message: '朗读失败: ' + error.message });
      });
    } catch (error) {
      const e: Error = error as Error;
      console.error('开始朗读时发生错误:', e);
      promptAction.showToast({ message: '开始朗读时发生错误' });
    }
  }

  // 停止朗读
  private stopPlay(): void {
    try {
      TextReader.stop();
      this.isPlaying = false;
    } catch (error) {
      const e: Error = error as Error;
      console.error('停止朗读时发生错误:', e);
    }
  }

  // 获取随机颜色
  private getRandomColor(): ResourceColor {
    const colors: Array<ResourceColor> = [
      Color.Red,
      Color.Blue,
      Color.Orange

    ];
    const randomIndex: number = Math.floor(Math.random() * colors.length);
    return colors[randomIndex];
  }

  // 获取诗歌的趣味解析
  private getPoemExplanation(): string {
    const explanations: Map<string, string> = new Map([
    // 卷一：五言古诗
      ['感遇・其一',
        '这是张九龄的代表作之一，诗中以兰叶、桂花的自然生长比喻人的本性，表达了人应保持本心、不求他人赏识的高洁品格。'],
      ['下终南山过斛斯山人宿置酒',
        '李白在这首诗中描绘了从终南山下来拜访友人的情景，展现了田园生活的宁静与美好，以及朋友间真挚的情谊。'],
      ['月下独酌四首・其一', '这首诗表现了李白在月夜独自饮酒的情景，通过与明月、影子共饮，表达了诗人孤独却又豁达的情怀。'],
      ['春思', '李白借春景写相思，通过燕草、秦桑等意象，表现了思妇对远行丈夫的深切思念。'],
      ['望岳', '杜甫青年时期的代表作，通过描绘泰山的雄伟，表达了诗人远大的志向和开阔的胸怀。'],
      ['赠卫八处士', '这首诗描写了诗人与老友重逢的情景，通过今昔对比，表现了乱世中友情的珍贵和人生的无常。'],
      ['佳人', '杜甫借佳人写自己，通过描写一位被遗弃女子的坚贞品格，表达了诗人自身坚守节操的情怀。'],
      ['梦李白二首・其一', '杜甫思念李白而作，表达了对友人安危的担忧和深切的思念之情。'],
      ['梦李白二首・其二', '这是杜甫思念李白的第二首诗，通过梦境表达对友人的关切和担忧。'],
      ['送綦毋潜落第还乡', '王维送别落第的朋友回乡，表达了对友人才华的肯定和安慰之情。'],

      // 卷二：五言乐府
      ['塞下曲・其一', '王昌龄的边塞诗，描绘了边塞的艰苦环境和战士们的坚韧精神。'],
      ['关山月', '李白的边塞诗，通过明月、关山等意象，表现了征人思乡的愁苦。'],
      ['子夜吴歌・春歌', '李白借乐府旧题写春情，表现了女子对丈夫的思念。'],
      ['子夜吴歌・夏歌', '李白借乐府旧题写夏景，描绘了江南夏日的美丽风光。'],
      ['子夜吴歌・秋歌', '李白借乐府旧题写秋思，表达了征人妻子的思念之情。'],
      ['子夜吴歌・冬歌', '李白借乐府旧题写冬情，表现了女子为远征丈夫准备冬衣的深情。'],
      ['长干行・其一', '李白的代表作之一，通过女子的口吻，描绘了从童年到成年的情感历程。'],
      ['烈女操', '孟郊借烈女之口，表达了对坚贞品格的赞美。'],
      ['游子吟', '孟郊歌颂母爱的经典之作，通过慈母为游子缝衣的细节，表现了母爱的伟大。'],
      ['登幽州台歌', '陈子昂的代表作，通过登高望远，表达了怀才不遇的孤独和悲愤。'],

      // 卷三：七言古诗
      ['庐山谣寄卢侍御虚舟', '李白描绘庐山壮丽景色的诗作，表现了对自然的热爱和对自由的向往。'],
      ['梦游天姥吟留别', '李白的代表作之一，通过梦游仙境的描写，表达了对现实的不满和对自由的追求。'],

      // 卷四：七言乐府
      ['蜀道难', '李白的代表作之一，通过夸张的手法描绘蜀道的艰险，表达了对友人入蜀的担忧。'],
      ['将进酒', '李白的豪放诗作，表现了及时行乐、不慕权贵的人生态度。'],

      // 卷五：五言律诗
      ['望月怀远', '张九龄的名作，通过望月抒发对远方友人的思念之情。'],
      ['送杜少府之任蜀州', '王勃的送别名作，一改传统送别诗的悲伤情调，表现了豁达的胸怀。'],
      ['春望', '杜甫在安史之乱中的代表作，通过春日景象表达了对国家命运的担忧和对家人的思念。'],
      ['月夜', '杜甫思念家人的作品，通过想象妻子在鄜州望月的情景，表现了深深的思念之情。'],

      // 卷六：七言律诗
      ['黄鹤楼', '崔颢的名作，通过登楼远眺，表达了对故乡的思念之情。'],
      ['登金陵凤凰台', '李白的怀古诗，通过凤凰台的兴衰，表达了对历史变迁的感慨。'],
      ['蜀相', '杜甫的怀古名作，通过凭吊诸葛亮，表达了对忠臣的敬仰和对自身遭遇的感慨。'],
      ['登高', '杜甫的代表作之一，通过登高所见，表现了诗人晚年多病、漂泊异乡的悲苦。'],

      // 卷七：五言绝句
      ['鹿柴', '王维的山水诗代表作，通过描绘鹿柴的幽静，表现了自然的宁静之美。'],
      ['竹里馆', '王维的隐逸诗，通过描写在竹林中弹琴长啸，表现了隐居生活的闲适。'],
      ['送别', '王维的送别诗，通过春草年年绿的自然现象，表达了对友人的不舍之情。'],
      ['相思', '王维的名作，通过红豆寄托相思之情，成为表达爱情的经典之作。'],
      ['杂诗', '王维的思乡诗，通过询问故乡来人，表现了对故乡的深切思念。'],
      ['静夜思', '李白的代表作之一，通过月光引发思乡之情，语言简洁却情感深沉。'],
      ['怨情', '李白的闺怨诗，通过描写美人独处的情景，表现了内心的孤独和怨恨。'],
      ['登鹳雀楼', '王之涣的名作，通过登楼远眺，表达了要想看得更远就要站得更高的哲理。'],
      ['春晓', '孟浩然的代表作，通过春晨醒来后的感受，表现了对春天美景的喜爱。'],
      ['宿建德江', '孟浩然的羁旅诗，通过江景的描绘，表现了漂泊在外的愁思。'],
      ['江雪', '柳宗元的代表作，通过描绘江雪独钓的场景，表现了孤傲不屈的精神。'],
      ['寻隐者不遇', '贾岛的名作，通过与童子的问答，表现了对隐逸生活的向往。'],
      ['行宫', '元稹的怀古诗，通过白头宫女的回忆，表现了盛衰兴替的历史感慨。'],

      // 卷八：七言绝句
      ['九月九日忆山东兄弟', '王维的思亲诗，通过重阳节登高的情景，表现了对兄弟的思念之情。'],
      ['芙蓉楼送辛渐', '王昌龄的送别诗，通过冰心在玉壶的比喻，表现了自己品格的纯洁。'],
      ['闺怨', '王昌龄的闺怨诗，通过少妇看到春景后的心理变化，表现了对丈夫从支持到埋怨的情感转变。'],
      ['凉州词二首・其一', '王翰的边塞诗，通过将士们在战场上的豪言壮语，表现了视死如归的英雄气概。'],
      ['出塞', '王昌龄的边塞诗代表作，通过历史的回顾，表现了对良将的期待和对和平的渴望。'],
      ['乌衣巷', '刘禹锡的怀古诗，通过乌衣巷的变迁，表现了历史的沧桑和世事的无常。'],
      ['春词', '刘禹锡的宫怨诗，通过宫女的日常生活，表现了宫中的寂寞和愁怨。'],
      ['竹枝词二首・其一', '刘禹锡的民歌体诗，通过描写江边春景，表现了青年男女的爱情。'],
      ['泊秦淮', '杜牧的讽喻诗，通过商女唱《后庭花》的情景，表现了对统治者不思进取的批评。'],
      ['夜雨寄北', '李商隐的思念诗，通过巴山夜雨的景象，表现了对妻子的深切思念。'],
      ['嫦娥', '李商隐的咏史诗，通过嫦娥的典故，表现了对孤独寂寞的感慨。'],
      ['贾生', '李商隐的怀古诗，通过贾谊的故事，表现了对统治者不重视民生的批评。'],
      ['瑶瑟怨', '温庭筠的宫怨诗，通过秋夜的景象，表现了宫女的哀怨之情。'],
      ['渭城曲', '王维的送别诗，通过渭城朝雨的景象，表现了对友人的深情厚谊。'],
      ['清平调・其一', '李白的应制诗，通过以花比人的手法，赞美了杨贵妃的美貌。'],
      ['清平调・其二', '李白的应制诗，通过赵飞燕的典故，进一步赞美杨贵妃的美艳。'],
      ['清平调・其三', '李白的应制诗，通过名花与美人的对比，表现了君王对妃子的宠爱。'],
      ['逢入京使', '岑参的边塞诗，通过在途中遇到入京使者，表达了对故乡的思念。'],
      ['滁州西涧', '韦应物的山水诗，通过描绘西涧春景，表现了对自然的热爱。'],
      ['夜上受降城闻笛', '李益的边塞诗，通过夜闻笛声，表现了征人对故乡的思念。'],

      // 继续添加更多诗歌解析...
      // 卷一：五言古诗
      ['青溪', '王维的山水诗，通过描绘青溪的景色，表现了诗人对宁静生活的向往。'],
      ['渭川田家', '王维的田园诗，通过描绘农村生活的场景，表现了对田园生活的喜爱。'],
      ['西施咏', '王维的咏史诗，通过西施的故事，表达了对人生浮沉的感慨。'],
      ['秋登兰山寄张五', '孟浩然的登高诗，通过秋日登高远望，表现了对友人的思念之情。'],
      ['夏日南亭怀辛大', '孟浩然的夏日诗，通过描绘夏夜的清凉，表现了对友人的怀念。'],
      ['宿业师山房期丁大不至', '孟浩然的山水诗，通过山中夜宿的情景，表现了对友人的等待之情。'],
      ['同从弟南斋玩月忆山阴崔少府', '王昌龄的咏月诗，通过玩月的情景，表达了对友人的思念。'],
      ['寻西山隐者不遇', '丘为的寻隐诗，通过寻访隐者不遇的经历，表现了对隐逸生活的向往。'],
      ['春泛若耶溪', '綦毋潜的山水诗，通过春日泛舟若耶溪的情景，表现了对自然的热爱。'],
      ['宿王昌龄隐居', '常建的访隐诗，通过访问王昌龄隐居地的感受，表现了对清净生活的向往。'],
      ['与高适薛据登慈恩寺浮图', '岑参的登塔诗，通过登塔远眺，表现了对人生的感悟。'],
      ['贼退示官吏', '元结的社会诗，通过贼退后的反思，表现了对民生疾苦的关注。'],
      ['郡斋雨中与诸文士燕集', '韦应物的宴集诗，通过雨中宴集的情景，表现了文人雅士的情怀。'],
      ['初发扬子寄元大校书', '韦应物的送别诗，通过扬子离别的情景，表现了对友人的不舍之情。'],
      ['寄全椒山中道士', '韦应物的寄友诗，通过寄诗给山中道士，表现了对友人的关怀之情。'],
      ['长安遇冯著', '韦应物的赠友诗，通过安慰朋友的失意，表现了对友人的关怀和鼓励。'],
      ['夕次盱眙县', '韦应物的羁旅诗，通过夜晚泊舟盱眙的情景，表现了对仕途的感慨。'],
      ['东郊', '韦应物的田园诗，通过描绘东郊春景，表现了对田园生活的向往。'],
      ['送杨氏女', '韦应物的送女诗，通过送别出嫁的女儿，表现了父女间的深情。'],
      ['晨诣超师院读禅经', '柳宗元的参禅诗，通过清晨读经的感受，表现了对禅理的领悟。'],
      ['溪居', '柳宗元的隐逸诗，通过描绘溪边隐居生活，表现了对宁静生活的向往。'],

      // 卷二：五言乐府
      ['古意', '李颀的边塞诗，通过描写征人思妇，表现了边塞生活的艰辛。'],
      ['长干行・其二', '崔颢的作品，通过描写女子的情感变化，表现了青春的活力。'],
      ['玉阶怨', '李白的宫怨诗，通过描写女子在玉阶上等待的情景，表现了宫中的寂寞。'],
      ['和张仆射塞下曲・其一', '卢纶的边塞诗，通过描写将军夜猎的情景，表现了将士的英勇。'],
      ['和张仆射塞下曲・其二', '卢纶的边塞诗，通过描写将士雪夜准备出征的情景，表现了军营生活。'],
      ['塞下曲', '卢纶的边塞诗，通过描写将士月夜追击敌人的情景，表现了将士的勇猛。'],
      ['和张仆射塞下曲・其四', '卢纶的边塞诗，通过描写将士雪夜追击敌人的场景，表现了将士的英勇。'],
      ['江南曲', '李益的乐府诗，通过描写江南水乡的生活，表现了对江南风光的喜爱。'],
      ['长干行', '李白的代表作，通过描写商妇的成长经历，表现了爱情的美好与坚贞。'],

      // 卷三：七言古诗
      ['送陈章甫', '李颀的送别诗，通过送别友人，表现了对友人才华的赞赏。'],
      ['琴歌', '李颀的音乐诗，通过描写琴声的美妙，表现了音乐的魅力。'],
      ['听董大弹胡笳声兼寄语弄房给事', '李颀的音乐诗，通过描写胡笳声的悲壮，表现了音乐的感染力。'],
      ['听安万善吹觱篥歌', '李颀的音乐诗，通过描写觱篥声的动人，表现了音乐的艺术魅力。'],
      ['夜归鹿门山歌', '孟浩然的归隐诗，通过描写夜归鹿门的情景，表现了对隐居生活的向往。'],
      ['金陵酒肆留别', '李白的送别诗，通过在酒肆与友人告别，表现了离别的情怀。'],
      ['宣州谢朓楼饯别校书叔云', '李白的送别诗，通过在谢朓楼为友人饯行，表现了对友人的不舍。'],
      ['走马川行奉送封大夫出师西征', '岑参的边塞诗，通过描写军队出征的情景，表现了将士的英勇。'],
      ['轮台歌奉送封大夫出师西征', '岑参的边塞诗，通过描写军队出征的壮观场面，表现了将士的豪情。'],
      ['白雪歌送武判官归京', '岑参的边塞诗，通过描写边塞雪景，表现了对友人的送别之情。'],
      ['韦讽录事宅观曹将军画马图', '杜甫的题画诗，通过观看画马，表现了对艺术的欣赏。'],
      ['丹青引赠曹将军霸', '杜甫的赠友诗，通过赞美曹霸的画技，表现了对友人的敬佩。'],
      ['寄韩谏议注', '杜甫的寄友诗，通过寄诗给友人，表现了对友人的思念和关怀。'],
      ['古柏行', '杜甫的咏物诗，通过赞美古柏，表现了对坚贞品格的推崇。'],
      ['观公孙大娘弟子舞剑器行', '杜甫的艺术诗，通过观看舞蹈，表现了对艺术的欣赏。'],
      ['石鱼湖上醉歌', '元结的饮酒诗，通过在湖上饮酒，表现了对自由生活的向往。'],
      ['山石', '韩愈的山水诗，通过描写山石景色，表现了对自然的热爱。'],
      ['八月十五夜赠张功曹', '韩愈的赠友诗，通过中秋夜与友人相聚，表现了友情的珍贵。'],
      ['谒衡岳庙遂宿岳寺题门楼', '韩愈的山水诗，通过游览衡山，表现了对自然景观的赞美。'],
      ['石鼓歌', '韩愈的咏物诗，通过赞美石鼓，表现了对文物的珍视。'],
      ['渔翁', '柳宗元的山水诗，通过描写渔翁的生活，表现了对隐逸生活的向往。'],
      ['长恨歌', '白居易的叙事诗，通过描写唐玄宗与杨贵妃的爱情故事，表现了爱情的悲剧。'],
      ['琵琶行（并序）', '白居易的叙事诗，通过琵琶女的演奏，表现了人生的感慨。'],
      ['韩碑', '李商隐的咏史诗，通过赞美韩愈的碑文，表现了对文人风骨的推崇。'],
      ['燕歌行（并序）', '高适的边塞诗，通过描写边塞战争，表现了对将士的同情。'],

      // 卷四：七言乐府
      ['古从军行', '李颀的边塞诗，通过描写从军生活，表现了对战争的反思。'],
      ['洛阳女儿行', '王维的乐府诗，通过描写洛阳女儿的生活，表现了富贵生活的奢华。'],
      ['老将行', '王维的乐府诗，通过描写老将的经历，表现了对英雄迟暮的感慨。'],
      ['桃源行', '王维的乐府诗，通过描写桃花源的美景，表现了对理想社会的向往。'],
      ['长相思・其一', '李白的思情诗，通过描写思念之苦，表现了爱情的深切。'],
      ['长相思・其二', '李白的思情诗，通过描写思君不见的痛苦，表现了爱情的执着。'],
      ['长相思・其三', '李白的思情诗，通过描写美人的思念，表现了爱情的缠绵。'],
      ['行路难三首・其二', '李白的抒怀诗，通过感叹行路之难，表现了人生的艰难。'],
      ['兵车行', '杜甫的叙事诗，通过描写征兵的场景，表现了对战争的批判。'],
      ['丽人行', '杜甫的讽刺诗，通过描写贵族妇女的奢华，表现了对社会风气的批评。'],
      ['哀江头', '杜甫的感怀诗，通过凭吊江头，表现了对国家兴衰的感慨。'],
      ['哀王孙', '杜甫的感怀诗，通过哀叹王孙的遭遇，表现了对国家命运的担忧。'],
      ['独不见', '沈佺期的闺怨诗，通过描写思妇的孤独，表现了对丈夫的思念。'],
      ['秋夜曲二首・其二', '王建的宫怨诗，通过描写秋夜的寂寞，表现了宫中的哀怨。'],
      ['长信秋词五首・其三', '王昌龄的宫怨诗，通过描写宫女的愁思，表现了宫廷生活的压抑。'],
      ['金缕衣', '佚名的乐府诗，通过劝人珍惜时光，表现了对人生的感悟。'],

      // 卷五：五言律诗
      ['经邹鲁祭孔子而叹之', '李隆基的怀古诗，通过祭祀孔子，表现了对圣贤的敬仰。'],
      ['在狱咏蝉', '骆宾王的咏物诗，通过咏蝉表达了自己的清白和不屈。'],
      ['和晋陵陆丞早春游望', '杜审言的山水诗，通过描写早春景色，表现了对自然的热爱。'],
      ['杂诗三首・其三', '沈佺期的思乡诗，通过描写思乡之情，表现了游子的心声。'],
      ['题大庾岭北驿', '宋之问的思乡诗，通过描写岭北驿站，表现了对家乡的思念。'],
      ['次北固山下', '王湾的山水诗，通过描写北固山下的景色，表现了对江南风光的喜爱。'],
      ['题破山寺后禅院', '常建的禅院诗，通过描写禅院的幽静，表现了对禅境的向往。'],
      ['寄左省杜拾遗', '岑参的寄友诗，通过寄诗给友人，表现了对友人的关怀。'],
      ['赠孟浩然', '李白的赠友诗，通过赞美孟浩然，表现了对友人才华的敬佩。'],
      ['渡荆门送别', '李白的送别诗，通过描写渡江送别，表现了对友人的不舍。'],
      ['送友人', '李白的送别诗，通过送别友人，表现了离别的情怀。'],
      ['听蜀僧濬弹琴', '李白的音乐诗，通过描写听琴的感受，表现了音乐的魅力。'],
      ['夜泊牛渚怀古', '李白的怀古诗，通过夜泊牛渚，表现了对历史的感慨。'],
      ['春宿左省', '杜甫的宫怨诗，通过描写在左省值夜，表现了对官场生活的感慨。'],
      ['至德二载甫自京金光门出间道归凤翔乾元初从左拾遗移华州掾与亲故别因出此门有悲往事',
        '杜甫的感怀诗，通过回忆往事，表现了对国家命运的担忧。'],
      ['月夜忆舍弟', '杜甫的思亲诗，通过月夜思念弟弟，表现了兄弟情深。'],
      ['天末怀李白', '杜甫的思友诗，通过怀念李白，表现了对友人的关切。'],
      ['奉济驿重送严公四韵', '杜甫的送别诗，通过在奉济驿送别，表现了对友人的不舍。'],
      ['别房太尉墓', '杜甫的悼亡诗，通过祭拜友人墓地，表现了对友人的怀念。'],
      ['旅夜书怀', '杜甫的羁旅诗，通过描写旅途夜景，表现了对人生的感慨。'],
      ['登岳阳楼', '杜甫的登临诗，通过登岳阳楼远眺，表现了对国家命运的担忧。'],
      ['辋川闲居赠裴秀才迪', '王维的赠友诗，通过描写与友人的交往，表现了隐居生活的乐趣。'],
      ['山居秋暝', '王维的山水诗，通过描写秋日山居的景色，表现了对隐居生活的喜爱。'],
      ['归嵩山作', '王维的归隐诗，通过描写归隐嵩山，表现了对山林生活的向往。'],
      ['终南山', '王维的山水诗，通过描写终南山的雄伟，表现了对自然的赞美。'],
      ['酬张少府', '王维的酬答诗，通过回应友人，表现了对隐逸生活的坚持。'],
      ['过香积寺', '王维的禅院诗，通过描写香积寺的幽静，表现了对禅境的向往。'],
      ['送梓州李使君', '王维的送别诗，通过送别友人赴任，表现了对友人的关怀。'],
      ['汉江临泛', '王维的山水诗，通过描写汉江泛舟，表现了对自然风光的喜爱。'],
      ['终南别业', '王维的隐逸诗，通过描写终南别业的生活，表现了对隐居生活的满足。'],
      ['望洞庭湖赠张丞相', '孟浩然的干谒诗，通过描写洞庭湖的壮阔，表现了对张丞相的敬仰。'],
      ['与诸子登岘山', '孟浩然的登临诗，通过登岘山怀古，表现了对历史的感慨。'],
      ['清明日宴梅道士房', '孟浩然的宴集诗，通过参加清明宴集，表现了对隐逸生活的向往。'],
      ['岁暮归南山', '孟浩然的归隐诗，通过描写岁暮归隐，表现了对官场的失望。'],
      ['过故人庄', '孟浩然的田园诗，通过描写拜访故人庄园，表现了田园生活的美好。'],
      ['秦中感秋寄远上人', '孟浩然的思友诗，通过秋天感怀，表现了对远方友人的思念。'],
      ['宿桐庐江寄广陵旧游', '孟浩然的羁旅诗，通过夜宿桐庐江，表现了对往昔的怀念。'],
      ['留别王侍御维', '孟浩然的送别诗，通过与友人告别，表现了离别的情怀。'],
      ['早寒江上有怀', '孟浩然的思乡诗，通过描写早寒江上的情景，表现了对家乡的思念。'],
      ['秋日登吴公台上寺远眺', '刘长卿的登临诗，通过登台远眺，表现了对历史兴衰的感慨。'],
      ['送李中丞之襄州', '刘长卿的送别诗，通过送别友人赴任，表现了对友人的祝福。'],
      ['饯别王十一南游', '刘长卿的送别诗，通过为友人饯行，表现了离别的情怀。'],
      ['寻南溪常山道人隐居', '刘长卿的寻隐诗，通过寻访隐者，表现了对隐逸生活的向往。'],
      ['新年作', '刘长卿的感怀诗，通过新年感怀，表现了对人生的感慨。'],
      ['送僧归日本', '钱起的送别诗，通过送别日本僧人，表现了对友人的祝福。'],
      ['谷口书斋寄杨补阙', '钱起的寄友诗，通过寄诗给友人，表现了对友人的关怀。'],
      ['淮上喜会梁州故人', '韦应物的聚会诗，通过与故人重逢，表现了友情的珍贵。'],
      ['赋得暮雨送李胄', '韦应物的送别诗，通过暮雨送别，表现了离别的情怀。'],
      ['酬程延秋夜即事见赠', '韩翃的酬答诗，通过回应友人，表现了对友情的珍视。'],
      ['阙题', '刘昚虚的山水诗，通过描写山水景色，表现了对自然的热爱。'],
      ['客夜与故人偶集', '戴叔伦的聚会诗，通过与故人夜聚，表现了友情的珍贵。'],
      ['喜见外弟又言别', '李益的聚会诗，通过与表弟重逢又别离，表现了人生的无常。'],
      ['云阳馆与韩绅宿别', '司空曙的送别诗，通过在云阳馆与友人告别，表现了离别的情怀。'],
      ['喜外弟卢纶见宿', '司空曙的聚会诗，通过表弟来访，表现了亲情的温暖。'],
      ['贼平后送人北归', '司空曙的送别诗，通过战乱平定后送人北归，表现了对和平的向往。'],
      ['蜀先主庙', '刘禹锡的怀古诗，通过凭吊刘备庙，表现了对历史英雄的敬仰。'],
      ['没蕃故人', '张籍的思友诗，通过思念在吐蕃去世的友人，表现了对友人的深切怀念。'],
      ['赋得古原草送别', '白居易的送别诗，通过描写古原草，表现了离别的情怀。'],
      ['旅宿', '杜牧的羁旅诗，通过描写旅途住宿，表现了游子的孤独。'],
      ['秋日赴阙题潼关驿楼', '许浑的羁旅诗，通过在潼关驿楼题诗，表现了对仕途的感慨。'],
      ['早秋三首・其一', '许浑的咏物诗，通过描写早秋景色，表现了对季节变化的敏感。'],
      ['蝉', '李商隐的咏物诗，通过咏蝉表达了自己的清高和不屈。'],
      ['风雨', '李商隐的感怀诗，通过描写风雨之夜，表现了对人生的感慨。'],
      ['落花', '李商隐的咏物诗，通过描写落花，表现了对时光流逝的感慨。'],
      ['凉思', '李商隐的思友诗，通过秋日凉思，表现了对友人的思念。'],
      ['北青萝', '李商隐的禅院诗，通过描写北青萝的幽静，表现了对禅境的向往。'],
      ['送人东游', '温庭筠的送别诗，通过送别友人东游，表现了离别的情怀。'],
      ['灞上秋居', '马戴的羁旅诗，通过描写灞上秋居，表现了游子的孤独。'],
      ['楚江怀古三首・其一', '马戴的怀古诗，通过楚江怀古，表现了对历史的感慨。'],
      ['书边事', '张乔的边塞诗，通过描写边塞事务，表现了对国家安危的关注。'],
      ['巴山道中除夜书怀', '崔涂的羁旅诗，通过除夕在巴山道中，表现了游子的思乡之情。'],
      ['孤雁二首・其二', '崔涂的咏物诗，通过描写孤雁，表现了自身的孤独。'],
      ['春宫怨', '杜荀鹤的宫怨诗，通过描写宫女的怨恨，表现了宫廷生活的压抑。'],
      ['章台夜思', '韦庄的思友诗，通过夜晚在章台思念，表现了对友人的深切思念。'],
      ['寻陆鸿渐不遇', '皎然的寻友诗，通过寻访友人不遇，表现了对友情的珍视。'],

      // 卷六：七言律诗
      ['行经华阴', '崔颢的山水诗，通过描写华阴的景色，表现了对自然的赞美。'],
      ['望蓟门', '祖咏的边塞诗，通过远望蓟门，表现了对边塞的感慨。'],
      ['九日登望仙台呈刘明府容', '崔曙的登临诗，通过重阳登台，表现了对友情的珍视。'],
      ['送魏万之京', '李颀的送别诗，通过送别友人赴京，表现了对友人的祝福。'],
      ['送李少府贬峡中王少府贬长沙', '高适的送别诗，通过送别被贬的友人，表现了对友人的同情。'],
      ['奉和中书舍人贾至早朝大明宫', '岑参的应制诗，通过描写早朝场景，表现了对朝廷的敬仰。'],
      ['和贾舍人早朝大明宫之作', '王维的应制诗，通过描写早朝场景，表现了对朝廷的敬仰。'],
      ['奉和圣制从蓬莱向兴庆阁道中留春雨中春望之作应制', '王维的应制诗，通过描写春雨中的宫苑景色，表现了对皇恩的感激。'],
      ['积雨辋川庄作', '王维的田园诗，通过描写积雨后的辋川庄，表现了对田园生活的喜爱。'],
      ['酬郭给事', '王维的酬答诗，通过回应郭给事，表现了对友情的珍视。'],
      ['客至', '杜甫的聚会诗，通过客人来访，表现了对友情的珍视。'],
      ['野望', '杜甫的田园诗，通过描写野望所见，表现了对田园生活的向往。'],
      ['闻官军收河南河北', '杜甫的感怀诗，通过听到收复失地的消息，表现了对国家命运的关切。'],
      ['登楼', '杜甫的登临诗，通过登楼远眺，表现了对国家命运的担忧。'],
      ['宿府', '杜甫的羁旅诗，通过在幕府住宿，表现了对官场生活的感慨。'],
      ['阁夜', '杜甫的羁旅诗，通过夜晚在阁中，表现了对时局的忧虑。'],
      ['咏怀古迹五首・其一', '杜甫的怀古诗，通过凭吊庾信故居，表现了对文人命运的感慨。'],
      ['咏怀古迹五首・其二', '杜甫的怀古诗，通过凭吊宋玉故居，表现了对文人命运的感慨。'],
      ['咏怀古迹五首・其三', '杜甫的怀古诗，通过凭吊王昭君，表现了对历史人物的同情。'],
      ['咏怀古迹五首・其四', '杜甫的怀古诗，通过凭吊刘备庙，表现了对历史英雄的敬仰。'],
      ['咏怀古迹五首・其五', '杜甫的怀古诗，通过凭吊诸葛亮庙，表现了对忠臣的敬仰。'],
      ['江州重别薛六柳八二员外', '刘长卿的送别诗，通过在江州与友人告别，表现了离别的情怀。'],
      ['长沙过贾谊宅', '刘长卿的怀古诗，通过凭吊贾谊宅，表现了对历史人物的同情。'],
      ['自夏口至鹦鹉洲夕望岳阳寄源中丞', '刘长卿的寄友诗，通过夕望岳阳寄诗给友人，表现了对友人的思念。'],
      ['赠阙下裴舍人', '钱起的干谒诗，通过赠诗给裴舍人，表现了对权贵的敬仰。'],
      ['寄李儋元锡', '韦应物的寄友诗，通过寄诗给友人，表现了对友人的思念。'],
      ['同题仙游观', '韩翃的寻仙诗，通过描写仙游观，表现了对神仙境界的向往。'],
      ['春思', '皇甫冉的思妇诗，通过描写思妇的情怀，表现了对丈夫的思念。'],
      ['晚次鄂州', '卢纶的羁旅诗，通过夜晚在鄂州，表现了游子的孤独。'],
      ['赠别严士元', '刘长卿的送别诗，通过送别友人，表现了离别的情怀。'],
      ['登柳州城楼寄漳汀封连四州刺史', '柳宗元的寄友诗，通过登楼寄诗给友人，表现了对友人的思念。'],
      ['西塞山怀古', '刘禹锡的怀古诗，通过凭吊西塞山，表现了对历史兴衰的感慨。'],
      ['遣悲怀三首・其一', '元稹的悼亡诗，通过怀念亡妻，表现了对爱情的忠贞。'],
      ['遣悲怀三首・其二', '元稹的悼亡诗，通过怀念亡妻，表现了对爱情的忠贞。'],
      ['遣悲怀三首・其三', '元稹的悼亡诗，通过怀念亡妻，表现了对爱情的忠贞。'],
      ['自河南经乱关内阻饥兄弟离散各在一处因望月有感聊书所怀寄上浮梁大兄於潜七兄乌江十五兄兼示符离及下邽弟妹',
        '白居易的思亲诗，通过望月思亲，表现了对家人的深切思念。'],
      ['锦瑟', '李商隐的感怀诗，通过锦瑟起兴，表现了对人生的感慨。'],
      ['无题・昨夜星辰昨夜风', '李商隐的爱情诗，通过描写幽会的情景，表现了爱情的美好与无奈。'],
      ['隋宫', '李商隐的咏史诗，通过凭吊隋宫，表现了对历史兴衰的感慨。'],
      ['无题二首・其一', '李商隐的爱情诗，通过描写爱情的甜蜜与痛苦，表现了情感的复杂。'],
      ['无题二首・其二', '李商隐的爱情诗，通过描写爱情的坚贞，表现了对爱情的执着。'],
      ['筹笔驿', '李商隐的怀古诗，通过凭吊诸葛亮遗迹，表现了对忠臣的敬仰。'],
      ['春雨', '李商隐的咏物诗，通过描写春雨，表现了对自然的观察。'],
      ['无题・相见时难别亦难', '李商隐的爱情诗，通过描写离别之苦，表现了爱情的深切。'],
      ['利州南渡', '温庭筠的山水诗，通过描写南渡的情景，表现了对自然的热爱。'],
      ['苏武庙', '温庭筠的怀古诗，通过凭吊苏武庙，表现了对忠臣的敬仰。'],

      // 卷七：五言绝句
      ['八阵图', '杜甫的咏史诗，通过赞美诸葛亮的八阵图，表现了对智者的敬仰。'],
      ['凉州词', '王之涣的边塞诗，通过描写边塞风光，表现了对边塞生活的感慨。'],
      ['春怨', '金昌绪的闺怨诗，通过描写思妇的情怀，表现了对丈夫的思念。'],
      ['哥舒歌', '西鄙人的边塞诗，通过歌颂哥舒翰，表现了对英雄的赞美。'],
      ['渡汉江', '宋之问的思乡诗，通过渡汉江回家，表现了对家乡的思念。'],
      ['南征怨', '张籍的边塞诗，通过描写南征的艰辛，表现了对战争的反思。'],
      ['夜到渔家', '张籍的羁旅诗，通过夜宿渔家，表现了对朴素生活的向往。'],
      ['听筝', '李端的音乐诗，通过描写听筝的感受，表现了音乐的魅力。'],
      ['鸣筝', '李端的音乐诗，通过描写筝声的动人，表现了音乐的艺术魅力。'],
      ['望庐山瀑布', '李白的山水诗，通过描写庐山瀑布，表现了对自然的赞美。'],
      ['独坐敬亭山', '李白的山水诗，通过独坐敬亭山，表现了对自然的热爱。'],
      ['客中行', '李白的饮酒诗，通过客中饮酒，表现了对生活的热爱。'],
      ['秋浦歌・其十四', '李白的感怀诗，通过秋浦歌咏，表现了对人生的感慨。'],
      ['赠汪伦', '李白的送别诗，通过汪伦送别，表现了友情的珍贵。'],
      ['逢雪宿芙蓉山主人', '刘长卿的羁旅诗，通过雪夜投宿，表现了对温暖的渴望。'],
      ['山中送别', '王维的送别诗，通过山中送别，表现了离别的情怀。'],

      // 卷八：七言绝句
      ['春宫曲', '王昌龄的宫怨诗，通过描写宫廷生活，表现了对宫廷生活的感慨。'],
      ['柳枝词', '刘禹锡的咏物诗，通过咏柳枝，表现了对春天的喜爱。'],
      ['寄扬州韩绰判官', '杜牧的寄友诗，通过寄诗给友人，表现了对友人的思念。'],
      ['遣怀', '杜牧的感怀诗，通过回忆往昔，表现了对人生的感慨。'],
      ['秋夕', '杜牧的宫怨诗，通过描写秋夜宫女，表现了宫廷生活的寂寞。'],
      ['赠别・其一', '杜牧的送别诗，通过送别美人，表现了离别的情怀。'],
      ['赠别・其二', '杜牧的送别诗，通过送别美人，表现了离别的情怀。'],
      ['金谷园', '杜牧的怀古诗，通过凭吊金谷园，表现了对历史兴衰的感慨。'],
      ['寄令狐郎中', '李商隐的寄友诗，通过寄诗给令狐郎中，表现了对友人的思念。'],
      ['为有', '李商隐的闺怨诗，通过描写少妇的情怀，表现了对爱情的渴望。'],
      ['瑶池', '李商隐的神话诗，通过描写瑶池仙境，表现了对神仙境界的向往。'],
      ['马嵬坡', '郑畋的咏史诗，通过凭吊马嵬坡，表现了对历史事件的感慨。'],
      ['已凉', '韩偓的闺怨诗，通过描写闺房的布置，表现了对爱情的向往。'],
      ['金陵图', '韦庄的怀古诗，通过凭吊金陵，表现了对历史兴衰的感慨。'],
      ['陇西行', '陈陶的边塞诗，通过描写边塞战争，表现了对战争的反思。'],
      ['寄人', '张泌的思情诗，通过寄诗给情人，表现了对爱情的思念。'],
      ['杂诗', '无名氏的思乡诗，通过描写思乡之情，表现了游子的心声。'],
      ['秋夜曲', '王维的宫怨诗，通过描写秋夜的寂寞，表现了宫中的哀怨。'],
      ['长信怨', '王昌龄的宫怨诗，通过描写宫女的怨恨，表现了宫廷生活的压抑。'],
      ['出塞', '王之涣的边塞诗，通过描写边塞风光，表现了对边塞生活的感慨。'],
      ['采莲曲', '王昌龄的乐府诗，通过描写采莲的情景，表现了江南水乡的美好。'],
      ['越女词', '李白的乐府诗，通过描写越女的生活，表现了对江南风光的喜爱。'],
      ['春行即兴', '李华的山水诗，通过描写春日行游，表现了对自然的热爱。'],
      ['寒食', '韩翃的节令诗，通过描写寒食节的情景，表现了对传统节日的重视。'],
      ['月夜', '刘方平的闺怨诗，通过描写月夜的情景，表现了对爱情的思念。'],
      ['春怨', '刘方平的闺怨诗，通过描写少妇的情怀，表现了对丈夫的思念。'],
      ['宫词', '顾况的宫怨诗，通过描写宫女的生活，表现了宫廷生活的寂寞。'],
      ['乌夜啼', '李白的乐府诗，通过描写乌鸦夜啼，表现了对人生的感慨。']
    ]);

    return explanations.get(this.poem.title) ||
      '这首诗描绘了诗人内心的情感世界，通过生动的意象表达了深刻的哲理和情感，值得细细品味。';
  }

  build() {
    Column() {
      Row() {
        Button('返回')
          .onClick(() => {
            router.back();
          })
          .margin({ left: 10 })
          .type(ButtonType.Normal)
          .borderRadius(20)
          .width(80)
          .height(40)
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .backgroundColor($r('app.color.card_background'))
          .fontColor($r('app.color.text_primary'))
          .animation({ duration: 300 })
          .shadow({
            radius: 5,
            color: $r('app.color.text_tertiary_bank_card_03'),
            offsetX: 0,
            offsetY: 2
          })
          .borderRadius(20)
          .width(80)
          .height(40)
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .backgroundColor($r('app.color.card_background'))
          .fontColor($r('app.color.text_primary'))
          .animation({ duration: 300 })
          .shadow({
            radius: 5,
            color: $r('app.color.text_tertiary_bank_card_03'),
            offsetX: 0,
            offsetY: 2
          })

        Text('诗歌详情')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
          .fontColor($r('app.color.text_primary'))

        // 添加朗读/暂停按钮
        Button(this.isPlaying ? '暂停' : '朗读')
          .onClick(() => {
            this.togglePlay();
          })
          .margin({ right: 10 })
          .type(ButtonType.Normal)
          .borderRadius(20)
          .width(80)
          .height(40)
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .backgroundColor(this.isPlaying ? '#FF9800' : '#4CAF50')
          .fontColor(Color.White)
          .animation({ duration: 300 })
          .shadow({
            radius: 5,
            color: this.isPlaying ? '#FF9800AA' : '#4CAF50AA',
            offsetX: 0,
            offsetY: 2
          })
      }
      .height(60)
      .alignItems(VerticalAlign.Center)
      .backgroundColor($r('app.color.card_background'))

      Scroll() {
        Column() {
          // 诗歌标题
          Text(this.poem.title)
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .margin({ top: 20 })
            .fontColor($r('app.color.text_primary'))

          // 作者
          Text('作者：' + this.poem.author)
            .fontSize(16)
            .fontColor($r('app.color.text_secondary'))
            .margin({ top: 10 })

          // 分隔线
          Divider()
            .margin({ top: 20, bottom: 20 })
            .color($r('app.color.text_tertiary'))

          // 诗歌正文（带拼音）
          Column() {
            this.renderPoemWithPinyin()
          }
          .padding(20)
          .backgroundColor($r('app.color.card_background'))
          .borderRadius(15)
          .shadow({
            radius: 6,
            color: $r('app.color.text_tertiary_bank_card_03'),
            offsetX: 0,
            offsetY: 2
          })
          .margin({ left: 20, right: 20 })

          // 趣味解析标题
          Text('趣味解析')
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
            .margin({ top: 30, bottom: 15 })
            .fontColor(this.getRandomColor())

          // 趣味解析内容
          Text(this.getPoemExplanation())
            .fontSize(16)
            .textAlign(TextAlign.Start)
            .fontStyle(FontStyle.Italic)
            .margin({ left: 20, right: 20 })
            .fontColor($r('app.color.text_primary'))
            .fontWeight(FontWeight.Normal)
            .fontColor(this.getRandomColor())

          // 添加爱心图标
          Text('❤')
            .fontSize(24)
            .fontColor('#FF0000')
            .textAlign(TextAlign.Center)
            .margin({ top: 10 })

          Blank()
        }
        .padding({ bottom: 20 })
      }
      .layoutWeight(1)
      .edgeEffect(EdgeEffect.Spring)
    }
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.page_background'))
  }

  // 使用@Builder渲染带拼音的诗歌
  @Builder
  private renderPoemWithPinyin() {
    ForEach(this.poem.content.split('\n'), (line: string, index: number) => {
      Column() {
        Flex({ justifyContent: FlexAlign.Center, alignItems: ItemAlign.Center }) {
          ForEach(this.getCharPinyinPairs(line, this.getPinyinLine(index)),
            (pair: CharPinyinPair, charIndex: number) => {
              if (/[\u4e00-\u9fa5]/.test(pair.char)) {
                Text(pair.pinyin)
                  .fontSize(12)
                  .textAlign(TextAlign.Center)
                  .fontColor($r('app.color.text_secondary'))
                  .width(24)
                  .margin({ left: 2, right: 2 })
              } else {
                Text('')
                  .fontSize(12)
                  .width(24)
                  .margin({ left: 2, right: 2 })
              }
            }, (pair: CharPinyinPair, charIndex: number) => pair.char + index.toString() + charIndex.toString())
        }
        .margin({ top: 5 })

        Flex({ justifyContent: FlexAlign.Center, alignItems: ItemAlign.Center }) {
          ForEach(this.getCharPinyinPairs(line, this.getPinyinLine(index)),
            (pair: CharPinyinPair, charIndex: number) => {
              Text(pair.char)
                .fontSize(18)
                .fontColor($r('app.color.text_primary'))
                .textAlign(TextAlign.Center)
                .width(24)
                .margin({ left: 2, right: 2 })
            }, (pair: CharPinyinPair, charIndex: number) => pair.char + index.toString() + charIndex.toString())
        }
        .margin({ top: 2, bottom: 10 })
      }
    }, (line: string) => line)
  }

  // 获取指定行的拼音
  private getPinyinLine(index: number): string {
    if (!this.poem.pinyin) {
      return '';
    }
    const pinyinLines: Array<string> = this.poem.pinyin.split('\n');
    return pinyinLines[index] || '';
  }

  // 获取字符和拼音的对应关系
  private getCharPinyinPairs(sentence: string, pinyinLine: string): CharPinyinPair[] {
    const result: CharPinyinPair[] = [];
    // 获取句子中的所有字符（包括汉字和标点符号）
    const chars: Array<string> = sentence.split('');

    // 处理拼音数组，去除多余空格并分割
    const pinyins: Array<string> = pinyinLine ? pinyinLine.trim().split(/\s+/) : [];

    // 用于跟踪拼音索引
    let pinyinIndex: number = 0;

    // 为每个字符分配对应的内容
    for (let i: number = 0; i < chars.length; i++) {
      const char: string = chars[i];
      // 判断是否为汉字
      if (/[\u4e00-\u9fa5]/.test(char)) {
        // 如果是汉字，则分配拼音
        result.push({
          char: char,
          pinyin: pinyins[pinyinIndex] || ''
        });
        pinyinIndex++;
      } else {
        // 如果是标点符号或其他字符，则不分配拼音
        result.push({
          char: char,
          pinyin: ''
        });
      }
    }

    return result;
  }
}