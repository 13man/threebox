import router from '@ohos.router';
import promptAction from '@ohos.promptAction';
import { TextReader, ReadStateCode } from '@kit.SpeechKit';

// å­—å—æ¥å£
interface CharBlock {
  char: string;
  correctIndex: number;  // æ­£ç¡®çš„ä½ç½®ç´¢å¼•
  currentIndex: number;  // å½“å‰ä½ç½®ç´¢å¼•
  id: string;
}

// æ‹¼å›¾è¯—å¥æ¥å£
interface PuzzlePoem {
  id: number;
  title: string;
  author: string;
  line: string;  // 7è¨€è¯—å¥
}

@Entry
@Component
struct PuzzleQuizPage {
  @State currentPoem: PuzzlePoem | null = null;
  @State charBlocks: CharBlock[] = [];
  @State slotBlocks: (CharBlock | null)[] = [];  // æ§½ä½æ•°ç»„
  @State draggedBlock: CharBlock | null = null;
  @State isCompleted: boolean = false;
  @State score: number = 0;
  @State level: number = 1;
  @State isReading: boolean = false;
  @State wrongAttempts: number = 0; // é”™è¯¯å°è¯•æ¬¡æ•°
  
  // è¯—å¥åº“ï¼ˆ200æ¡ç»å…¸è¯—å¥ï¼‰
  private poemDatabase: PuzzlePoem[] = [
    // æç™½è¯—å¥
    { id: 1, title: 'é™å¤œæ€', author: 'æç™½', line: 'åºŠå‰æ˜æœˆå…‰' },
    { id: 2, title: 'é™å¤œæ€', author: 'æç™½', line: 'ç–‘æ˜¯åœ°ä¸Šéœœ' },
    { id: 3, title: 'é™å¤œæ€', author: 'æç™½', line: 'ä¸¾å¤´æœ›æ˜æœˆ' },
    { id: 4, title: 'é™å¤œæ€', author: 'æç™½', line: 'ä½å¤´æ€æ•…ä¹¡' },
    { id: 5, title: 'æœ›åºå±±ç€‘å¸ƒ', author: 'æç™½', line: 'æ—¥ç…§é¦™ç‚‰ç”Ÿç´«çƒŸ' },
    { id: 6, title: 'æœ›åºå±±ç€‘å¸ƒ', author: 'æç™½', line: 'é¥çœ‹ç€‘å¸ƒæŒ‚å‰å·' },
    { id: 7, title: 'æœ›åºå±±ç€‘å¸ƒ', author: 'æç™½', line: 'é£æµç›´ä¸‹ä¸‰åƒå°º' },
    { id: 8, title: 'æœ›åºå±±ç€‘å¸ƒ', author: 'æç™½', line: 'ç–‘æ˜¯é“¶æ²³è½ä¹å¤©' },
    { id: 9, title: 'æ—©å‘ç™½å¸åŸ', author: 'æç™½', line: 'æœè¾ç™½å¸å½©äº‘é—´' },
    { id: 10, title: 'æ—©å‘ç™½å¸åŸ', author: 'æç™½', line: 'åƒé‡Œæ±Ÿé™µä¸€æ—¥è¿˜' },
    { id: 11, title: 'æ—©å‘ç™½å¸åŸ', author: 'æç™½', line: 'ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½' },
    { id: 12, title: 'æ—©å‘ç™½å¸åŸ', author: 'æç™½', line: 'è½»èˆŸå·²è¿‡ä¸‡é‡å±±' },
    { id: 13, title: 'èµ æ±ªä¼¦', author: 'æç™½', line: 'æç™½ä¹˜èˆŸå°†æ¬²è¡Œ' },
    { id: 14, title: 'èµ æ±ªä¼¦', author: 'æç™½', line: 'å¿½é—»å²¸ä¸Šè¸æ­Œå£°' },
    { id: 15, title: 'èµ æ±ªä¼¦', author: 'æç™½', line: 'æ¡ƒèŠ±æ½­æ°´æ·±åƒå°º' },
    { id: 16, title: 'èµ æ±ªä¼¦', author: 'æç™½', line: 'ä¸åŠæ±ªä¼¦é€æˆ‘æƒ…' },
    { id: 17, title: 'é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶', author: 'æç™½', line: 'æ•…äººè¥¿è¾é»„é¹¤æ¥¼' },
    { id: 18, title: 'é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶', author: 'æç™½', line: 'çƒŸèŠ±ä¸‰æœˆä¸‹æ‰¬å·' },
    { id: 19, title: 'é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶', author: 'æç™½', line: 'å­¤å¸†è¿œå½±ç¢§ç©ºå°½' },
    { id: 20, title: 'é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶', author: 'æç™½', line: 'å”¯è§é•¿æ±Ÿå¤©é™…æµ' },
    
    // æœç”«è¯—å¥
    { id: 21, title: 'æ˜¥å¤œå–œé›¨', author: 'æœç”«', line: 'å¥½é›¨çŸ¥æ—¶èŠ‚' },
    { id: 22, title: 'æ˜¥å¤œå–œé›¨', author: 'æœç”«', line: 'å½“æ˜¥ä¹ƒå‘ç”Ÿ' },
    { id: 23, title: 'æ˜¥å¤œå–œé›¨', author: 'æœç”«', line: 'éšé£æ½œå…¥å¤œ' },
    { id: 24, title: 'æ˜¥å¤œå–œé›¨', author: 'æœç”«', line: 'æ¶¦ç‰©ç»†æ— å£°' },
    { id: 25, title: 'ç»å¥', author: 'æœç”«', line: 'ä¸¤ä¸ªé»„é¹‚é¸£ç¿ æŸ³' },
    { id: 26, title: 'ç»å¥', author: 'æœç”«', line: 'ä¸€è¡Œç™½é¹­ä¸Šé’å¤©' },
    { id: 27, title: 'ç»å¥', author: 'æœç”«', line: 'çª—å«è¥¿å²­åƒç§‹é›ª' },
    { id: 28, title: 'ç»å¥', author: 'æœç”«', line: 'é—¨æ³Šä¸œå´ä¸‡é‡Œèˆ¹' },
    { id: 29, title: 'æ±Ÿç•”ç‹¬æ­¥å¯»èŠ±', author: 'æœç”«', line: 'é»„å››å¨˜å®¶èŠ±æ»¡è¹Š' },
    { id: 30, title: 'æ±Ÿç•”ç‹¬æ­¥å¯»èŠ±', author: 'æœç”«', line: 'åƒæœµä¸‡æœµå‹æä½' },
    { id: 31, title: 'æ±Ÿç•”ç‹¬æ­¥å¯»èŠ±', author: 'æœç”«', line: 'ç•™è¿æˆè¶æ—¶æ—¶èˆ' },
    { id: 32, title: 'æ±Ÿç•”ç‹¬æ­¥å¯»èŠ±', author: 'æœç”«', line: 'è‡ªåœ¨å¨‡èºæ°æ°å•¼' },
    
    // ç‹ä¹‹æ¶£è¯—å¥
    { id: 33, title: 'ç™»é¹³é›€æ¥¼', author: 'ç‹ä¹‹æ¶£', line: 'ç™½æ—¥ä¾å±±å°½' },
    { id: 34, title: 'ç™»é¹³é›€æ¥¼', author: 'ç‹ä¹‹æ¶£', line: 'é»„æ²³å…¥æµ·æµ' },
    { id: 35, title: 'ç™»é¹³é›€æ¥¼', author: 'ç‹ä¹‹æ¶£', line: 'æ¬²ç©·åƒé‡Œç›®' },
    { id: 36, title: 'ç™»é¹³é›€æ¥¼', author: 'ç‹ä¹‹æ¶£', line: 'æ›´ä¸Šä¸€å±‚æ¥¼' },
    { id: 37, title: 'å‡‰å·è¯', author: 'ç‹ä¹‹æ¶£', line: 'é»„æ²³è¿œä¸Šç™½äº‘é—´' },
    { id: 38, title: 'å‡‰å·è¯', author: 'ç‹ä¹‹æ¶£', line: 'ä¸€ç‰‡å­¤åŸä¸‡ä»å±±' },
    { id: 39, title: 'å‡‰å·è¯', author: 'ç‹ä¹‹æ¶£', line: 'ç¾Œç¬›ä½•é¡»æ€¨æ¨æŸ³' },
    { id: 40, title: 'å‡‰å·è¯', author: 'ç‹ä¹‹æ¶£', line: 'æ˜¥é£ä¸åº¦ç‰é—¨å…³' },
    
    // å­Ÿæµ©ç„¶è¯—å¥
    { id: 41, title: 'æ˜¥æ™“', author: 'å­Ÿæµ©ç„¶', line: 'æ˜¥çœ ä¸è§‰æ™“' },
    { id: 42, title: 'æ˜¥æ™“', author: 'å­Ÿæµ©ç„¶', line: 'å¤„å¤„é—»å•¼é¸Ÿ' },
    { id: 43, title: 'æ˜¥æ™“', author: 'å­Ÿæµ©ç„¶', line: 'å¤œæ¥é£é›¨å£°' },
    { id: 44, title: 'æ˜¥æ™“', author: 'å­Ÿæµ©ç„¶', line: 'èŠ±è½çŸ¥å¤šå°‘' },
    { id: 45, title: 'å®¿å»ºå¾·æ±Ÿ', author: 'å­Ÿæµ©ç„¶', line: 'ç§»èˆŸæ³ŠçƒŸæ¸š' },
    { id: 46, title: 'å®¿å»ºå¾·æ±Ÿ', author: 'å­Ÿæµ©ç„¶', line: 'æ—¥æš®å®¢æ„æ–°' },
    { id: 47, title: 'å®¿å»ºå¾·æ±Ÿ', author: 'å­Ÿæµ©ç„¶', line: 'é‡æ—·å¤©ä½æ ‘' },
    { id: 48, title: 'å®¿å»ºå¾·æ±Ÿ', author: 'å­Ÿæµ©ç„¶', line: 'æ±Ÿæ¸…æœˆè¿‘äºº' },
    
    // ç‹ç»´è¯—å¥
    { id: 49, title: 'ä¹æœˆä¹æ—¥å¿†å±±ä¸œå…„å¼Ÿ', author: 'ç‹ç»´', line: 'ç‹¬åœ¨å¼‚ä¹¡ä¸ºå¼‚å®¢' },
    { id: 50, title: 'ä¹æœˆä¹æ—¥å¿†å±±ä¸œå…„å¼Ÿ', author: 'ç‹ç»´', line: 'æ¯é€¢ä½³èŠ‚å€æ€äº²' },
    { id: 51, title: 'ä¹æœˆä¹æ—¥å¿†å±±ä¸œå…„å¼Ÿ', author: 'ç‹ç»´', line: 'é¥çŸ¥å…„å¼Ÿç™»é«˜å¤„' },
    { id: 52, title: 'ä¹æœˆä¹æ—¥å¿†å±±ä¸œå…„å¼Ÿ', author: 'ç‹ç»´', line: 'éæ’èŒ±è¸å°‘ä¸€äºº' },
    { id: 53, title: 'é¹¿æŸ´', author: 'ç‹ç»´', line: 'ç©ºå±±ä¸è§äºº' },
    { id: 54, title: 'é¹¿æŸ´', author: 'ç‹ç»´', line: 'ä½†é—»äººè¯­å“' },
    { id: 55, title: 'é¹¿æŸ´', author: 'ç‹ç»´', line: 'è¿”æ™¯å…¥æ·±æ—' },
    { id: 56, title: 'é¹¿æŸ´', author: 'ç‹ç»´', line: 'å¤ç…§é’è‹”ä¸Š' },
    { id: 57, title: 'ç«¹é‡Œé¦†', author: 'ç‹ç»´', line: 'ç‹¬åå¹½ç¯é‡Œ' },
    { id: 58, title: 'ç«¹é‡Œé¦†', author: 'ç‹ç»´', line: 'å¼¹ç´å¤é•¿å•¸' },
    { id: 59, title: 'ç«¹é‡Œé¦†', author: 'ç‹ç»´', line: 'æ·±æ—äººä¸çŸ¥' },
    { id: 60, title: 'ç«¹é‡Œé¦†', author: 'ç‹ç»´', line: 'æ˜æœˆæ¥ç›¸ç…§' },
    
    // ç™½å±…æ˜“è¯—å¥
    { id: 61, title: 'èµ‹å¾—å¤åŸè‰é€åˆ«', author: 'ç™½å±…æ˜“', line: 'ç¦»ç¦»åŸä¸Šè‰' },
    { id: 62, title: 'èµ‹å¾—å¤åŸè‰é€åˆ«', author: 'ç™½å±…æ˜“', line: 'ä¸€å²ä¸€æ¯è£' },
    { id: 63, title: 'èµ‹å¾—å¤åŸè‰é€åˆ«', author: 'ç™½å±…æ˜“', line: 'é‡ç«çƒ§ä¸å°½' },
    { id: 64, title: 'èµ‹å¾—å¤åŸè‰é€åˆ«', author: 'ç™½å±…æ˜“', line: 'æ˜¥é£å¹åˆç”Ÿ' },
    { id: 65, title: 'å¿†æ±Ÿå—', author: 'ç™½å±…æ˜“', line: 'æ±Ÿå—å¥½' },
    { id: 66, title: 'å¿†æ±Ÿå—', author: 'ç™½å±…æ˜“', line: 'é£æ™¯æ—§æ›¾è°™' },
    { id: 67, title: 'å¿†æ±Ÿå—', author: 'ç™½å±…æ˜“', line: 'æ—¥å‡ºæ±ŸèŠ±çº¢èƒœç«' },
    { id: 68, title: 'å¿†æ±Ÿå—', author: 'ç™½å±…æ˜“', line: 'æ˜¥æ¥æ±Ÿæ°´ç»¿å¦‚è“' },
    { id: 69, title: 'æ± ä¸Š', author: 'ç™½å±…æ˜“', line: 'å°å¨ƒæ’‘å°è‰‡' },
    { id: 70, title: 'æ± ä¸Š', author: 'ç™½å±…æ˜“', line: 'å·é‡‡ç™½è²å›' },
    { id: 71, title: 'æ± ä¸Š', author: 'ç™½å±…æ˜“', line: 'ä¸è§£è—è¸ªè¿¹' },
    { id: 72, title: 'æ± ä¸Š', author: 'ç™½å±…æ˜“', line: 'æµ®èä¸€é“å¼€' },
    
    // æœç‰§è¯—å¥
    { id: 73, title: 'æ¸…æ˜', author: 'æœç‰§', line: 'æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·' },
    { id: 74, title: 'æ¸…æ˜', author: 'æœç‰§', line: 'è·¯ä¸Šè¡Œäººæ¬²æ–­é­‚' },
    { id: 75, title: 'æ¸…æ˜', author: 'æœç‰§', line: 'å€Ÿé—®é…’å®¶ä½•å¤„æœ‰' },
    { id: 76, title: 'æ¸…æ˜', author: 'æœç‰§', line: 'ç‰§ç«¥é¥æŒ‡æèŠ±æ‘' },
    { id: 77, title: 'å±±è¡Œ', author: 'æœç‰§', line: 'è¿œä¸Šå¯’å±±çŸ³å¾„æ–œ' },
    { id: 78, title: 'å±±è¡Œ', author: 'æœç‰§', line: 'ç™½äº‘æ·±å¤„æœ‰äººå®¶' },
    { id: 79, title: 'å±±è¡Œ', author: 'æœç‰§', line: 'åœè½¦åçˆ±æ«æ—æ™š' },
    { id: 80, title: 'å±±è¡Œ', author: 'æœç‰§', line: 'éœœå¶çº¢äºäºŒæœˆèŠ±' },
    
    // è´ºçŸ¥ç« è¯—å¥
    { id: 81, title: 'å’æŸ³', author: 'è´ºçŸ¥ç« ', line: 'ç¢§ç‰å¦†æˆä¸€æ ‘é«˜' },
    { id: 82, title: 'å’æŸ³', author: 'è´ºçŸ¥ç« ', line: 'ä¸‡æ¡å‚ä¸‹ç»¿ä¸ç»¦' },
    { id: 83, title: 'å’æŸ³', author: 'è´ºçŸ¥ç« ', line: 'ä¸çŸ¥ç»†å¶è°è£å‡º' },
    { id: 84, title: 'å’æŸ³', author: 'è´ºçŸ¥ç« ', line: 'äºŒæœˆæ˜¥é£ä¼¼å‰ªåˆ€' },
    { id: 85, title: 'å›ä¹¡å¶ä¹¦', author: 'è´ºçŸ¥ç« ', line: 'å°‘å°ç¦»å®¶è€å¤§å›' },
    { id: 86, title: 'å›ä¹¡å¶ä¹¦', author: 'è´ºçŸ¥ç« ', line: 'ä¹¡éŸ³æ— æ”¹é¬“æ¯›è¡°' },
    { id: 87, title: 'å›ä¹¡å¶ä¹¦', author: 'è´ºçŸ¥ç« ', line: 'å„¿ç«¥ç›¸è§ä¸ç›¸è¯†' },
    { id: 88, title: 'å›ä¹¡å¶ä¹¦', author: 'è´ºçŸ¥ç« ', line: 'ç¬‘é—®å®¢ä»ä½•å¤„æ¥' },
    
    // éª†å®¾ç‹è¯—å¥
    { id: 89, title: 'å’é¹…', author: 'éª†å®¾ç‹', line: 'é¹…é¹…é¹…' },
    { id: 90, title: 'å’é¹…', author: 'éª†å®¾ç‹', line: 'æ›²é¡¹å‘å¤©æ­Œ' },
    { id: 91, title: 'å’é¹…', author: 'éª†å®¾ç‹', line: 'ç™½æ¯›æµ®ç»¿æ°´' },
    { id: 92, title: 'å’é¹…', author: 'éª†å®¾ç‹', line: 'çº¢æŒæ‹¨æ¸…æ³¢' },
    
    // æç»…è¯—å¥
    { id: 93, title: 'æ‚¯å†œ', author: 'æç»…', line: 'é”„ç¦¾æ—¥å½“åˆ' },
    { id: 94, title: 'æ‚¯å†œ', author: 'æç»…', line: 'æ±—æ»´ç¦¾ä¸‹åœŸ' },
    { id: 95, title: 'æ‚¯å†œ', author: 'æç»…', line: 'è°çŸ¥ç›˜ä¸­é¤' },
    { id: 96, title: 'æ‚¯å†œ', author: 'æç»…', line: 'ç²’ç²’çš†è¾›è‹¦' },
    { id: 97, title: 'æ‚¯å†œ', author: 'æç»…', line: 'æ˜¥ç§ä¸€ç²’ç²Ÿ' },
    { id: 98, title: 'æ‚¯å†œ', author: 'æç»…', line: 'ç§‹æ”¶ä¸‡é¢—å­' },
    { id: 99, title: 'æ‚¯å†œ', author: 'æç»…', line: 'å››æµ·æ— é—²ç”°' },
    { id: 100, title: 'æ‚¯å†œ', author: 'æç»…', line: 'å†œå¤«çŠ¹é¥¿æ­»' },
    
    // ç‹æ˜Œé¾„è¯—å¥
    { id: 101, title: 'å‡ºå¡', author: 'ç‹æ˜Œé¾„', line: 'ç§¦æ—¶æ˜æœˆæ±‰æ—¶å…³' },
    { id: 102, title: 'å‡ºå¡', author: 'ç‹æ˜Œé¾„', line: 'ä¸‡é‡Œé•¿å¾äººæœªè¿˜' },
    { id: 103, title: 'å‡ºå¡', author: 'ç‹æ˜Œé¾„', line: 'ä½†ä½¿é¾™åŸé£å°†åœ¨' },
    { id: 104, title: 'å‡ºå¡', author: 'ç‹æ˜Œé¾„', line: 'ä¸æ•™èƒ¡é©¬åº¦é˜´å±±' },
    { id: 105, title: 'èŠ™è“‰æ¥¼é€è¾›æ¸', author: 'ç‹æ˜Œé¾„', line: 'å¯’é›¨è¿æ±Ÿå¤œå…¥å´' },
    { id: 106, title: 'èŠ™è“‰æ¥¼é€è¾›æ¸', author: 'ç‹æ˜Œé¾„', line: 'å¹³æ˜é€å®¢æ¥šå±±å­¤' },
    { id: 107, title: 'èŠ™è“‰æ¥¼é€è¾›æ¸', author: 'ç‹æ˜Œé¾„', line: 'æ´›é˜³äº²å‹å¦‚ç›¸é—®' },
    { id: 108, title: 'èŠ™è“‰æ¥¼é€è¾›æ¸', author: 'ç‹æ˜Œé¾„', line: 'ä¸€ç‰‡å†°å¿ƒåœ¨ç‰å£¶' },
    
    // æŸ³å®—å…ƒè¯—å¥
    { id: 109, title: 'æ±Ÿé›ª', author: 'æŸ³å®—å…ƒ', line: 'åƒå±±é¸Ÿé£ç»' },
    { id: 110, title: 'æ±Ÿé›ª', author: 'æŸ³å®—å…ƒ', line: 'ä¸‡å¾„äººè¸ªç­' },
    { id: 111, title: 'æ±Ÿé›ª', author: 'æŸ³å®—å…ƒ', line: 'å­¤èˆŸè“‘ç¬ ç¿' },
    { id: 112, title: 'æ±Ÿé›ª', author: 'æŸ³å®—å…ƒ', line: 'ç‹¬é’“å¯’æ±Ÿé›ª' },
    
    // åˆ˜ç¦¹é”¡è¯—å¥
    { id: 113, title: 'ç«¹æè¯', author: 'åˆ˜ç¦¹é”¡', line: 'æ¨æŸ³é’é’æ±Ÿæ°´å¹³' },
    { id: 114, title: 'ç«¹æè¯', author: 'åˆ˜ç¦¹é”¡', line: 'é—»éƒæ±Ÿä¸Šè¸æ­Œå£°' },
    { id: 115, title: 'ç«¹æè¯', author: 'åˆ˜ç¦¹é”¡', line: 'ä¸œè¾¹æ—¥å‡ºè¥¿è¾¹é›¨' },
    { id: 116, title: 'ç«¹æè¯', author: 'åˆ˜ç¦¹é”¡', line: 'é“æ˜¯æ— æ™´å´æœ‰æ™´' },
    { id: 117, title: 'æµªæ·˜æ²™', author: 'åˆ˜ç¦¹é”¡', line: 'ä¹æ›²é»„æ²³ä¸‡é‡Œæ²™' },
    { id: 118, title: 'æµªæ·˜æ²™', author: 'åˆ˜ç¦¹é”¡', line: 'æµªæ·˜é£ç°¸è‡ªå¤©æ¶¯' },
    { id: 119, title: 'æµªæ·˜æ²™', author: 'åˆ˜ç¦¹é”¡', line: 'å¦‚ä»Šç›´ä¸Šé“¶æ²³å»' },
    { id: 120, title: 'æµªæ·˜æ²™', author: 'åˆ˜ç¦¹é”¡', line: 'åŒåˆ°ç‰µç‰›ç»‡å¥³å®¶' },
    
    // å¼ ç»§è¯—å¥
    { id: 121, title: 'æ«æ¡¥å¤œæ³Š', author: 'å¼ ç»§', line: 'æœˆè½ä¹Œå•¼éœœæ»¡å¤©' },
    { id: 122, title: 'æ«æ¡¥å¤œæ³Š', author: 'å¼ ç»§', line: 'æ±Ÿæ«æ¸”ç«å¯¹æ„çœ ' },
    { id: 123, title: 'æ«æ¡¥å¤œæ³Š', author: 'å¼ ç»§', line: 'å§‘è‹åŸå¤–å¯’å±±å¯º' },
    { id: 124, title: 'æ«æ¡¥å¤œæ³Š', author: 'å¼ ç»§', line: 'å¤œåŠé’Ÿå£°åˆ°å®¢èˆ¹' },
    
    // é«˜é€‚è¯—å¥
    { id: 125, title: 'åˆ«è‘£å¤§', author: 'é«˜é€‚', line: 'åƒé‡Œé»„äº‘ç™½æ—¥æ››' },
    { id: 126, title: 'åˆ«è‘£å¤§', author: 'é«˜é€‚', line: 'åŒ—é£å¹é›é›ªçº·çº·' },
    { id: 127, title: 'åˆ«è‘£å¤§', author: 'é«˜é€‚', line: 'è«æ„å‰è·¯æ— çŸ¥å·±' },
    { id: 128, title: 'åˆ«è‘£å¤§', author: 'é«˜é€‚', line: 'å¤©ä¸‹è°äººä¸è¯†å›' },
    
    // éŸ©æ„ˆè¯—å¥
    { id: 129, title: 'æ—©æ˜¥å‘ˆæ°´éƒ¨å¼ åå…«å‘˜å¤–', author: 'éŸ©æ„ˆ', line: 'å¤©è¡—å°é›¨æ¶¦å¦‚é…¥' },
    { id: 130, title: 'æ—©æ˜¥å‘ˆæ°´éƒ¨å¼ åå…«å‘˜å¤–', author: 'éŸ©æ„ˆ', line: 'è‰è‰²é¥çœ‹è¿‘å´æ— ' },
    { id: 131, title: 'æ—©æ˜¥å‘ˆæ°´éƒ¨å¼ åå…«å‘˜å¤–', author: 'éŸ©æ„ˆ', line: 'æœ€æ˜¯ä¸€å¹´æ˜¥å¥½å¤„' },
    { id: 132, title: 'æ—©æ˜¥å‘ˆæ°´éƒ¨å¼ åå…«å‘˜å¤–', author: 'éŸ©æ„ˆ', line: 'ç»èƒœçƒŸæŸ³æ»¡çš‡éƒ½' },
    
    // å¢çº¶è¯—å¥
    { id: 133, title: 'å¡ä¸‹æ›²', author: 'å¢çº¶', line: 'æœˆé»‘é›é£é«˜' },
    { id: 134, title: 'å¡ä¸‹æ›²', author: 'å¢çº¶', line: 'å•äºå¤œéé€ƒ' },
    { id: 135, title: 'å¡ä¸‹æ›²', author: 'å¢çº¶', line: 'æ¬²å°†è½»éª‘é€' },
    { id: 136, title: 'å¡ä¸‹æ›²', author: 'å¢çº¶', line: 'å¤§é›ªæ»¡å¼“åˆ€' },
    { id: 137, title: 'å¡ä¸‹æ›²', author: 'å¢çº¶', line: 'æ—æš—è‰æƒŠé£' },
    { id: 138, title: 'å¡ä¸‹æ›²', author: 'å¢çº¶', line: 'å°†å†›å¤œå¼•å¼“' },
    { id: 139, title: 'å¡ä¸‹æ›²', author: 'å¢çº¶', line: 'å¹³æ˜å¯»ç™½ç¾½' },
    { id: 140, title: 'å¡ä¸‹æ›²', author: 'å¢çº¶', line: 'æ²¡åœ¨çŸ³æ£±ä¸­' },
    
    // å­ŸéƒŠè¯—å¥
    { id: 141, title: 'æ¸¸å­åŸ', author: 'å­ŸéƒŠ', line: 'æ…ˆæ¯æ‰‹ä¸­çº¿' },
    { id: 142, title: 'æ¸¸å­åŸ', author: 'å­ŸéƒŠ', line: 'æ¸¸å­èº«ä¸Šè¡£' },
    { id: 143, title: 'æ¸¸å­åŸ', author: 'å­ŸéƒŠ', line: 'ä¸´è¡Œå¯†å¯†ç¼' },
    { id: 144, title: 'æ¸¸å­åŸ', author: 'å­ŸéƒŠ', line: 'æ„æè¿Ÿè¿Ÿå½’' },
    { id: 145, title: 'æ¸¸å­åŸ', author: 'å­ŸéƒŠ', line: 'è°è¨€å¯¸è‰å¿ƒ' },
    { id: 146, title: 'æ¸¸å­åŸ', author: 'å­ŸéƒŠ', line: 'æŠ¥å¾—ä¸‰æ˜¥æ™–' },
    
    // å¼ å¿—å’Œè¯—å¥
    { id: 147, title: 'æ¸”æ­Œå­', author: 'å¼ å¿—å’Œ', line: 'è¥¿å¡å±±å‰ç™½é¹­é£' },
    { id: 148, title: 'æ¸”æ­Œå­', author: 'å¼ å¿—å’Œ', line: 'æ¡ƒèŠ±æµæ°´é³œé±¼è‚¥' },
    { id: 149, title: 'æ¸”æ­Œå­', author: 'å¼ å¿—å’Œ', line: 'é’ç®¬ç¬ ' },
    { id: 150, title: 'æ¸”æ­Œå­', author: 'å¼ å¿—å’Œ', line: 'ç»¿è“‘è¡£' },
    { id: 151, title: 'æ¸”æ­Œå­', author: 'å¼ å¿—å’Œ', line: 'æ–œé£ç»†é›¨ä¸é¡»å½’' },
    
    // ç‹å‹ƒè¯—å¥
    { id: 152, title: 'é€æœå°‘åºœä¹‹ä»»èœ€å·', author: 'ç‹å‹ƒ', line: 'åŸé˜™è¾…ä¸‰ç§¦' },
    { id: 153, title: 'é€æœå°‘åºœä¹‹ä»»èœ€å·', author: 'ç‹å‹ƒ', line: 'é£çƒŸæœ›äº”æ´¥' },
    { id: 154, title: 'é€æœå°‘åºœä¹‹ä»»èœ€å·', author: 'ç‹å‹ƒ', line: 'ä¸å›ç¦»åˆ«æ„' },
    { id: 155, title: 'é€æœå°‘åºœä¹‹ä»»èœ€å·', author: 'ç‹å‹ƒ', line: 'åŒæ˜¯å®¦æ¸¸äºº' },
    { id: 156, title: 'é€æœå°‘åºœä¹‹ä»»èœ€å·', author: 'ç‹å‹ƒ', line: 'æµ·å†…å­˜çŸ¥å·±' },
    { id: 157, title: 'é€æœå°‘åºœä¹‹ä»»èœ€å·', author: 'ç‹å‹ƒ', line: 'å¤©æ¶¯è‹¥æ¯”é‚»' },
    
    // å®‹ä¹‹é—®è¯—å¥
    { id: 158, title: 'æ¸¡æ±‰æ±Ÿ', author: 'å®‹ä¹‹é—®', line: 'å²­å¤–éŸ³ä¹¦æ–­' },
    { id: 159, title: 'æ¸¡æ±‰æ±Ÿ', author: 'å®‹ä¹‹é—®', line: 'ç»å†¬å¤å†æ˜¥' },
    { id: 160, title: 'æ¸¡æ±‰æ±Ÿ', author: 'å®‹ä¹‹é—®', line: 'è¿‘ä¹¡æƒ…æ›´æ€¯' },
    { id: 161, title: 'æ¸¡æ±‰æ±Ÿ', author: 'å®‹ä¹‹é—®', line: 'ä¸æ•¢é—®æ¥äºº' },
    
    // å´”é¢¢è¯—å¥
    { id: 162, title: 'é»„é¹¤æ¥¼', author: 'å´”é¢¢', line: 'æ˜”äººå·²ä¹˜é»„é¹¤å»' },
    { id: 163, title: 'é»„é¹¤æ¥¼', author: 'å´”é¢¢', line: 'æ­¤åœ°ç©ºä½™é»„é¹¤æ¥¼' },
    { id: 164, title: 'é»„é¹¤æ¥¼', author: 'å´”é¢¢', line: 'é»„é¹¤ä¸€å»ä¸å¤è¿”' },
    { id: 165, title: 'é»„é¹¤æ¥¼', author: 'å´”é¢¢', line: 'ç™½äº‘åƒè½½ç©ºæ‚ æ‚ ' },
    
    // æå•†éšè¯—å¥
    { id: 166, title: 'å¤œé›¨å¯„åŒ—', author: 'æå•†éš', line: 'å›é—®å½’æœŸæœªæœ‰æœŸ' },
    { id: 167, title: 'å¤œé›¨å¯„åŒ—', author: 'æå•†éš', line: 'å·´å±±å¤œé›¨æ¶¨ç§‹æ± ' },
    { id: 168, title: 'å¤œé›¨å¯„åŒ—', author: 'æå•†éš', line: 'ä½•å½“å…±å‰ªè¥¿çª—çƒ›' },
    { id: 169, title: 'å¤œé›¨å¯„åŒ—', author: 'æå•†éš', line: 'å´è¯å·´å±±å¤œé›¨æ—¶' },
    { id: 170, title: 'ç™»ä¹æ¸¸åŸ', author: 'æå•†éš', line: 'å‘æ™šæ„ä¸é€‚' },
    { id: 171, title: 'ç™»ä¹æ¸¸åŸ', author: 'æå•†éš', line: 'é©±è½¦ç™»å¤åŸ' },
    { id: 172, title: 'ç™»ä¹æ¸¸åŸ', author: 'æå•†éš', line: 'å¤•é˜³æ— é™å¥½' },
    { id: 173, title: 'ç™»ä¹æ¸¸åŸ', author: 'æå•†éš', line: 'åªæ˜¯è¿‘é»„æ˜' },
    
    // æ¸©åº­ç­ è¯—å¥
    { id: 174, title: 'å•†å±±æ—©è¡Œ', author: 'æ¸©åº­ç­ ', line: 'æ™¨èµ·åŠ¨å¾é“' },
    { id: 175, title: 'å•†å±±æ—©è¡Œ', author: 'æ¸©åº­ç­ ', line: 'å®¢è¡Œæ‚²æ•…ä¹¡' },
    { id: 176, title: 'å•†å±±æ—©è¡Œ', author: 'æ¸©åº­ç­ ', line: 'é¸¡å£°èŒ…åº—æœˆ' },
    { id: 177, title: 'å•†å±±æ—©è¡Œ', author: 'æ¸©åº­ç­ ', line: 'äººè¿¹æ¿æ¡¥éœœ' },
    
    // éƒ‘ç‡®è¯—å¥
    { id: 178, title: 'ç«¹çŸ³', author: 'éƒ‘ç‡®', line: 'å’¬å®šé’å±±ä¸æ”¾æ¾' },
    { id: 179, title: 'ç«¹çŸ³', author: 'éƒ‘ç‡®', line: 'ç«‹æ ¹åŸåœ¨ç ´å²©ä¸­' },
    { id: 180, title: 'ç«¹çŸ³', author: 'éƒ‘ç‡®', line: 'åƒç£¨ä¸‡å‡»è¿˜åšåŠ²' },
    { id: 181, title: 'ç«¹çŸ³', author: 'éƒ‘ç‡®', line: 'ä»»å°”ä¸œè¥¿å—åŒ—é£' },
    
    // è¢æšè¯—å¥
    { id: 182, title: 'æ‰€è§', author: 'è¢æš', line: 'ç‰§ç«¥éª‘é»„ç‰›' },
    { id: 183, title: 'æ‰€è§', author: 'è¢æš', line: 'æ­Œå£°æŒ¯æ—æ¨¾' },
    { id: 184, title: 'æ‰€è§', author: 'è¢æš', line: 'æ„æ¬²æ•é¸£è‰' },
    { id: 185, title: 'æ‰€è§', author: 'è¢æš', line: 'å¿½ç„¶é—­å£ç«‹' },
    
    // é¾šè‡ªçè¯—å¥
    { id: 186, title: 'å·±äº¥æ‚è¯—', author: 'é¾šè‡ªç', line: 'ä¹å·ç”Ÿæ°”æƒé£é›·' },
    { id: 187, title: 'å·±äº¥æ‚è¯—', author: 'é¾šè‡ªç', line: 'ä¸‡é©¬é½å–‘ç©¶å¯å“€' },
    { id: 188, title: 'å·±äº¥æ‚è¯—', author: 'é¾šè‡ªç', line: 'æˆ‘åŠå¤©å…¬é‡æŠ–æ“' },
    { id: 189, title: 'å·±äº¥æ‚è¯—', author: 'é¾šè‡ªç', line: 'ä¸æ‹˜ä¸€æ ¼é™äººæ‰' },
    { id: 190, title: 'å·±äº¥æ‚è¯—', author: 'é¾šè‡ªç', line: 'æµ©è¡ç¦»æ„ç™½æ—¥æ–œ' },
    { id: 191, title: 'å·±äº¥æ‚è¯—', author: 'é¾šè‡ªç', line: 'åŸé­ä¸œæŒ‡å³å¤©æ¶¯' },
    { id: 192, title: 'å·±äº¥æ‚è¯—', author: 'é¾šè‡ªç', line: 'è½çº¢ä¸æ˜¯æ— æƒ…ç‰©' },
    { id: 193, title: 'å·±äº¥æ‚è¯—', author: 'é¾šè‡ªç', line: 'åŒ–ä½œæ˜¥æ³¥æ›´æŠ¤èŠ±' },
    
    // äºè°¦è¯—å¥
    { id: 194, title: 'çŸ³ç°åŸ', author: 'äºè°¦', line: 'åƒé”¤ä¸‡å‡¿å‡ºæ·±å±±' },
    { id: 195, title: 'çŸ³ç°åŸ', author: 'äºè°¦', line: 'çƒˆç«ç„šçƒ§è‹¥ç­‰é—²' },
    { id: 196, title: 'çŸ³ç°åŸ', author: 'äºè°¦', line: 'ç²‰éª¨ç¢èº«å…¨ä¸æ€•' },
    { id: 197, title: 'çŸ³ç°åŸ', author: 'äºè°¦', line: 'è¦ç•™æ¸…ç™½åœ¨äººé—´' },
    
    // éƒ‘æ€è‚–è¯—å¥
    { id: 198, title: 'ç”»èŠ', author: 'éƒ‘æ€è‚–', line: 'èŠ±å¼€ä¸å¹¶ç™¾èŠ±ä¸›' },
    { id: 199, title: 'ç”»èŠ', author: 'éƒ‘æ€è‚–', line: 'ç‹¬ç«‹ç–ç¯±è¶£æœªç©·' },
    { id: 200, title: 'ç”»èŠ', author: 'éƒ‘æ€è‚–', line: 'å®å¯æå¤´æŠ±é¦™æ­»' }
  ];
  
  aboutToAppear(): void {
    this.initTextReader();
    this.loadNewPuzzle();
  }
  
  aboutToDisappear(): void {
    try {
      TextReader.stop();
      TextReader.release();
    } catch (error) {
      console.error('é‡Šæ”¾TextReaderå¤±è´¥:', error);
    }
  }
  
  // åˆå§‹åŒ–TextReader
  private async initTextReader(): Promise<void> {
    try {
      const businessBrandInfo: TextReader.BusinessBrandInfo = { 
        panelName: 'æ‹¼å›¾æœ—è¯»'
      };
      
      const readerParam: TextReader.ReaderParam = {
        isVoiceBrandVisible: false,
        businessBrandInfo: businessBrandInfo,
        keepBackgroundRunning: false
      };

      await TextReader.init(getContext(this), readerParam);
      console.log('TextReaderåˆå§‹åŒ–æˆåŠŸ');
    } catch (error) {
      console.error('TextReaderåˆå§‹åŒ–å¤±è´¥:', error);
    }
  }
  
  // åŠ è½½æ–°æ‹¼å›¾
  private loadNewPuzzle(): void {
    const randomIndex = Math.floor(Math.random() * this.poemDatabase.length);
    this.currentPoem = this.poemDatabase[randomIndex];
    this.wrongAttempts = 0; // é‡ç½®é”™è¯¯æ¬¡æ•°
    
    this.resetCurrentPuzzle();
  }
  
  // é‡ç½®å½“å‰æ‹¼å›¾ï¼ˆä¸æ›´æ¢é¢˜ç›®ï¼‰
  private resetCurrentPuzzle(): void {
    if (!this.currentPoem) return;
    
    // åˆ›å»ºå­—å—ï¼Œæ˜¾å¼å£°æ˜ç±»å‹
    const chars = this.currentPoem.line.split('');
    this.charBlocks = chars.map((char, index): CharBlock => {
      return {
        char: char,
        correctIndex: index,
        currentIndex: -1,
        id: `char_${index}_${Date.now()}`
      };
    });
    
    // æ‰“ä¹±å­—å—é¡ºåº
    this.shuffleArray(this.charBlocks);
    
    // åˆå§‹åŒ–æ§½ä½ï¼ˆå…¨ç©ºï¼‰
    this.slotBlocks = new Array(chars.length).fill(null);
    
    this.isCompleted = false;

  }
  
  // æ‰“ä¹±æ•°ç»„ï¼ˆFisher-Yatesæ´—ç‰Œç®—æ³•ï¼‰
  private shuffleArray(array: CharBlock[]): void {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      // é¿å…è§£æ„èµ‹å€¼ï¼Œä½¿ç”¨ä¸´æ—¶å˜é‡
      const temp = array[i];
      array[i] = array[j];
      array[j] = temp;
    }
  }
  
  // æ£€æŸ¥æ˜¯å¦å®Œæˆ
  private checkCompletion(): void {
    if (this.slotBlocks.every(block => block !== null)) {
      const isCorrect = this.slotBlocks.every((block, index) => 
        block!.correctIndex === index
      );
      
      if (isCorrect) {
        this.isCompleted = true;
        this.wrongAttempts = 0; // é‡ç½®é”™è¯¯æ¬¡æ•°
        this.score += 10;
        promptAction.showToast({ message: 'ğŸ‰ æ‹¼å¯¹äº†ï¼' });
        
        // æœ—è¯»è¯—å¥
        setTimeout(() => {
          this.readPoem();
        }, 500);
      } else {
        // æ‹¼é”™äº†ï¼Œå¢åŠ é”™è¯¯æ¬¡æ•°
        this.wrongAttempts++;
        console.log('[PuzzleQuiz] é”™è¯¯æ¬¡æ•°:', this.wrongAttempts);
        
        if (this.wrongAttempts === 1) {
          promptAction.showToast({ 
            message: 'âŒ å“å‘€ï¼Œé¡ºåºä¸å¯¹å“¦~å†æƒ³æƒ³ï¼',
            duration: 2000
          });
        } else if (this.wrongAttempts === 2) {
          promptAction.showToast({ 
            message: 'âŒ è¿˜æ˜¯ä¸å¯¹å‘¢ï¼Œè¿™æ¬¡åœ¨é”™çš„è¯å°±ç»™ä½ çœ‹ç­”æ¡ˆå“ˆï¼ŸğŸ¤”',
            duration: 2000
          });
        } else if (this.wrongAttempts >= 3) {
          // ç¬¬3æ¬¡é”™è¯¯ï¼Œç»™å‡ºç­”æ¡ˆæç¤ºï¼ˆä¿çš®ç‰ˆï¼‰
          if (this.currentPoem) {
            const correctAnswer = this.currentPoem.line;
            promptAction.showToast({ 
              message: `ğŸ’¡ åˆ«ç°å¿ƒï¼ç­”æ¡ˆæ˜¯ï¼šã€Œ${correctAnswer}ã€\nçœ‹çœ‹èƒ½ä¸èƒ½æ‹¼å‡ºæ¥å‘€~ åŠ æ²¹ï¼ğŸ’ª`,
              duration: 4000
            });
          }
        }
      }
    }
  }
  
  // æœ—è¯»è¯—å¥
  private async readPoem(): Promise<void> {
    if (!this.currentPoem) return;
    
    try {
      const readInfo: TextReader.ReadInfo = {
        id: `puzzle_${this.currentPoem.id}`,
        title: {
          text: this.currentPoem.title,
          isClickable: false
        },
        bodyInfo: this.currentPoem.line
      };
      
      await TextReader.start([readInfo]);
      this.isReading = true;
      
      // ç›‘å¬æœ—è¯»å®Œæˆ
      setTimeout(() => {
        this.isReading = false;
      }, 3000);
    } catch (error) {
      console.error('æœ—è¯»å¤±è´¥:', error);
    }
  }
  
  build() {
    Column() {
      // æ ‡é¢˜æ 
      Row() {
        Image($r('sys.symbol.chevron_left'))
          .width(24)
          .height(24)
          .fillColor($r('app.color.text_primary'))
          .onClick(() => {
            router.back();
          })
        
        Text('ğŸ§© æ®‹å¥æ‹¼å›¾')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor($r('app.color.text_primary'))
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
        
        Column() {
          Text(`${this.level}/${this.poemDatabase.length}`)
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor($r('app.color.text_primary'))
            .margin({ bottom: 2 })
          Text(`${this.score}åˆ†`)
            .fontSize(12)
            .fontColor($r('app.color.accent_positive'))
        }
        .alignItems(HorizontalAlign.End)
        .width(60)
      }
      .width('100%')
      .height(60)
      .padding({ left: 16, right: 16 })
      .backgroundColor($r('app.color.card_background'))
      
      Scroll() {
        Column() {
          // è¯—è¯ä¿¡æ¯å¡ç‰‡
          if (this.currentPoem) {
            Column() {
              Text(this.currentPoem.title)
                .fontSize(20)
                .fontWeight(FontWeight.Bold)
                .fontColor($r('app.color.text_primary'))
                .margin({ bottom: 4 })
              
              Text(`ã€${this.currentPoem.author}ã€‘`)
                .fontSize(14)
                .fontColor($r('app.color.text_secondary'))
            }
            .width('100%')
            .padding(16)
            .backgroundColor($r('app.color.card_background'))
            .borderRadius(12)
            .margin({ top: 16, bottom: 16 })
          }
          
          // æ‹¼å›¾æ§½ä½åŒºåŸŸ
          Column() {
            Text('ğŸ‘† ç‚¹å‡»ä¸Šæ–¹æ§½ä½æ”¾ç½®å­—å—ï¼Œå†ç‚¹å‡»å¯é€€å­—')
              .fontSize(14)
              .fontColor($r('app.color.text_tertiary'))
              .margin({ bottom: 12 })
            
            this.SlotArea()
          }
          .width('100%')
          .padding(20)
          .backgroundColor($r('app.color.card_background'))
          .borderRadius(16)
          .margin({ bottom: 24 })
          
          // å­—å—åŒºåŸŸ
          Column() {
            Text('ğŸ‘‡ ç‚¹å‡»å­—å—é€‰ä¸­ï¼Œç„¶åç‚¹å‡»ä¸Šæ–¹æ§½ä½æ”¾ç½®')
              .fontSize(14)
              .fontColor($r('app.color.text_tertiary'))
              .margin({ bottom: 12 })
            
            this.CharBlockArea()
          }
          .width('100%')
          .padding(20)
          .backgroundColor($r('app.color.card_background'))
          .borderRadius(16)
          
          // æ“ä½œæŒ‰é’®
          Row() {
            Button('ğŸ”„ é‡æ–°å¼€å§‹')
              .width('48%')
              .height(50)
              .fontSize(16)
              .backgroundColor($r('app.color.card_background'))
              .fontColor($r('app.color.text_primary'))
              .borderRadius(25)
              .onClick(() => {
                this.resetCurrentPuzzle(); // é‡ç½®å½“å‰é¢˜ç›®
              })
            
            Button('â¡ï¸ ä¸‹ä¸€é¢˜')
              .width('48%')
              .height(50)
              .fontSize(16)
              .backgroundColor($r('app.color.accent_positive'))
              .fontColor('#FFFFFF')
              .borderRadius(25)
              .enabled(this.isCompleted)
              .opacity(this.isCompleted ? 1 : 0.5)
              .onClick(() => {
                this.level++;
                this.loadNewPuzzle();
              })
          }
          .width('100%')
          .justifyContent(FlexAlign.SpaceBetween)
          .margin({ top: 24, bottom: 24 })
        }
        .width('100%')
        .padding({ left: 16, right: 16 })
      }
      .layoutWeight(1)
      .edgeEffect(EdgeEffect.Spring)
    }
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.page_background'))
  }
  
  @Builder
  SlotArea() {
    Flex({ wrap: FlexWrap.Wrap, justifyContent: FlexAlign.Center }) {
      ForEach(this.slotBlocks, (block: CharBlock | null, index: number) => {
        Column() {
          if (block) {
            Text(block.char)
              .fontSize(28)
              .fontWeight(FontWeight.Bold)
              .fontColor(this.isCompleted ? '#4CAF50' : $r('app.color.text_primary'))
          } else {
            Text('__')
              .fontSize(28)
              .fontColor($r('app.color.text_tertiary'))
              .opacity(0.3)
          }
        }
        .width(50)
        .height(60)
        .justifyContent(FlexAlign.Center)
        .backgroundColor(block ? '#E8F5E9' : $r('app.color.page_background'))
        .borderRadius(8)
        .border({ 
          width: 2, 
          color: this.isCompleted ? '#4CAF50' : $r('app.color.text_tertiary'),
          style: BorderStyle.Dashed
        })
        .margin(4)
        .onClick(() => {
          console.log('[PuzzleQuiz] ç‚¹å‡»æ§½ä½', index, ', å½“å‰å­—å—:', block?.char, ', é€‰ä¸­çš„:', this.draggedBlock?.char);
          
          // å¦‚æœæœ‰é€‰ä¸­çš„å­—å—ï¼Œæ”¾ç½®åˆ°è¿™ä¸ªæ§½ä½
          if (this.draggedBlock && !this.isCompleted) {
            // å¦‚æœæ§½ä½å·²æœ‰å­—å—ï¼Œå°†å…¶ç§»å›å­—å—åŒº
            if (block) {
              console.log('[PuzzleQuiz] æ§½ä½å·²æœ‰å­—å—:', block.char, 'ï¼Œç§»å›å­—å—åŒº');
              block.currentIndex = -1;
              this.charBlocks.push(block);
            }
            
            // ä»å­—å—åŒºç§»é™¤
            const charIndex = this.charBlocks.findIndex(b => b.id === this.draggedBlock!.id);
            console.log('[PuzzleQuiz] ä»å­—å—åŒºç§»é™¤ç´¢å¼•:', charIndex);
            if (charIndex >= 0) {
              this.charBlocks.splice(charIndex, 1);
            }
            
            // æ”¾ç½®åˆ°æ§½ä½
            console.log('[PuzzleQuiz] æ”¾ç½®å­—å—:', this.draggedBlock.char, 'åˆ°æ§½ä½', index);
            this.slotBlocks[index] = this.draggedBlock;
            this.draggedBlock.currentIndex = index;
            
            // æ¸…ç©ºé€‰ä¸­çŠ¶æ€
            const placedChar = this.draggedBlock.char;
            this.draggedBlock = null;
            
            // å…³é”®ï¼šå¼ºåˆ¶åˆ·æ–°æ•°ç»„å¼•ç”¨ï¼Œè§¦å‘è§†å›¾æ›´æ–°
            this.slotBlocks = this.slotBlocks.slice();
            this.charBlocks = this.charBlocks.slice();
            
            console.log('[PuzzleQuiz] å½“å‰æ§½ä½çŠ¶æ€:', this.slotBlocks.map(b => b?.char || '_'));
            console.log('[PuzzleQuiz] å‰©ä½™å­—å—:', this.charBlocks.map(b => b.char));
            
            promptAction.showToast({ message: `âœ… å·²æ”¾ç½®â€œ${placedChar}â€` });
            
            // æ£€æŸ¥æ˜¯å¦å®Œæˆ
            setTimeout(() => {
              this.checkCompletion();
            }, 100);
          }
          // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„å­—å—ï¼Œä½†æ§½ä½æœ‰å­—ï¼Œåˆ™ç§»é™¤
          else if (block && !this.isCompleted) {
            console.log('[PuzzleQuiz] ç§»é™¤æ§½ä½å­—å—:', block.char);
            const removedBlock = this.slotBlocks[index];
            if (removedBlock) {
              removedBlock.currentIndex = -1;
              this.charBlocks.push(removedBlock);
              this.slotBlocks[index] = null;
              
              // å…³é”®ï¼šå¼ºåˆ¶åˆ·æ–°æ•°ç»„å¼•ç”¨
              this.slotBlocks = this.slotBlocks.slice();
              this.charBlocks = this.charBlocks.slice();
            }
          }
        })
      }, (block: CharBlock | null, index: number) => `slot_${index}_${block?.id || 'empty'}`)
    }
  }
  
  @Builder
  CharBlockArea() {
    Flex({ wrap: FlexWrap.Wrap, justifyContent: FlexAlign.Center }) {
      ForEach(this.charBlocks, (block: CharBlock, index: number) => {
        Column() {
          Text(block.char)
            .fontSize(28)
            .fontWeight(FontWeight.Bold)
            .fontColor('#FFFFFF')
            .textAlign(TextAlign.Center)
        }
        .width(50)
        .height(60)
        .justifyContent(FlexAlign.Center)
        .backgroundColor($r('app.color.song_lyric_card'))
        .borderRadius(8)
        .margin(4)
        .shadow({
          radius: 8,
          color: 'rgba(0, 0, 0, 0.2)',
          offsetX: 0,
          offsetY: 2
        })
        .draggable(false)  // ç¦ç”¨åŸç”Ÿæ‹–æ‹½ï¼Œä½¿ç”¨ç‚¹å‡»æ–¹å¼
        .onClick(() => {
          console.log('[PuzzleQuiz] ç‚¹å‡»å­—å—:', block.char);
          // ç‚¹å‡»é€‰ä¸­å­—å—
          this.draggedBlock = block;
          promptAction.showToast({ message: `å·²é€‰ä¸­â€œ${block.char}â€ï¼Œç‚¹å‡»ä¸Šæ–¹æ§½ä½æ”¾ç½®` });
        })
        .backgroundColor(
          this.draggedBlock?.id === block.id 
            ? '#FF6B35'  // é€‰ä¸­æ—¶é«˜äº®
            : $r('app.color.song_lyric_card')
        )
      }, (block: CharBlock) => block.id)
    }
  }
}
