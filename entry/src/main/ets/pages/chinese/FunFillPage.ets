import router from '@ohos.router';

interface GameMode {
  id: number;
  title: string;
  icon: string;
  description: string;
  difficulty: string;
  color: ResourceColor;
  route: string;
}

@Entry
@Component
export struct FunFillPage {
  @State isPageLoaded: boolean = false;
  @State selectedMode: number = -1;  // é€‰ä¸­çš„æ¸¸æˆæ¨¡å¼

  // æ¸¸æˆæ¨¡å¼åˆ—è¡¨
  private gameModes: GameMode[] = [
    {
      id: 1,
      title: 'ðŸŽ¯ è¯—äººå¡«è¯',
      icon: 'ðŸ–‹ï¸',
      description: 'é€‰æ‹©å–œçˆ±çš„è¯—äººï¼ŒæŒ‘æˆ¨20é¦–è‘—åè¯—ä½œ',
      difficulty: 'ç»å…¸æ¨¡å¼',
      color: $r('app.color.tang_poem_card'),
      route: 'pages/chinese/PoetSelectionPage'
    },
    {
      id: 2,
      title: 'ðŸŽ² æ‘‡ä¸€æ‘‡å‡ºé¢˜',
      icon: 'ðŸŽ€',
      description: 'æ‰‹æœºæ‘‡ä¸€æ‘‡ï¼ŒéšæœºæŠ½å–é”¦é²¤è¯—é¢˜',
      difficulty: 'æƒŠå–œç›²ç›’',
      color: $r('app.color.accent_positive'),
      route: 'pages/chinese/ShakeQuizPage'
    },
    {
      id: 3,
      title: 'ðŸ§© æ®‹å¥æ‹¼å›¾',
      icon: 'ðŸ”¤',
      description: 'æ‹–æ‹½æ±‰å­—æ‹¼å›¾ï¼Œè¿˜åŽŸå®Œæ•´è¯—å¥',
      difficulty: 'è¶£å‘³é—¯å…³',
      color: $r('app.color.song_lyric_card'),
      route: 'pages/chinese/PuzzleQuizPage'
    },
    {
      id: 4,
      title: 'ðŸ–Œï¸ å¢¨æ±é®ç›–',
      icon: 'ðŸ’§',
      description: 'æ“¦é™¤å¢¨æ±æ­ç¤ºè¯—å¥ï¼Œè§£åŽ‹åˆç›Šæ™º',
      difficulty: 'è§£åŽ‹æ¨¡å¼',
      color: '#2C2C2C',
      route: 'pages/chinese/InkWipePage'
    }
  ];

  aboutToAppear(): void {
    setTimeout(() => {
      this.isPageLoaded = true;
    }, 100);
  }

  build() {
    Column() {
      // æ ‡é¢˜æ 
      Row() {
        Text('è¶£å‘³é—¯å…³')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
          .fontColor($r('app.color.text_primary'))
      }
      .height(60)
      .alignItems(VerticalAlign.Center)
      .backgroundColor($r('app.color.card_background'))

      Scroll() {
        Column() {
          // ä»‹ç»åŒºåŸŸ
          Column() {
            Text('ðŸŽ® ä¸‰å¤§æ¸¸æˆæ¨¡å¼')
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor($r('app.color.text_primary'))
              .margin({ bottom: 8 })
            
            Text('é€‰æ‹©ä½ å–œæ¬¢çš„æ¸¸æˆæ–¹å¼ï¼Œå¼€å¯è¯—è¯ä¹‹æ—…')
              .fontSize(14)
              .fontColor($r('app.color.text_secondary'))
              .textAlign(TextAlign.Center)
          }
          .width('100%')
          .padding({ top: 20, bottom: 20 })
          .opacity(this.isPageLoaded ? 1 : 0)
          .animation({ duration: 400, delay: 100 })

          // æ¸¸æˆæ¨¡å¼å¡ç‰‡
          ForEach(this.gameModes, (mode: GameMode, index: number) => {
            this.GameModeCard(mode, index)
          })

          // åº•éƒ¨æç¤º
          Text('ðŸ’¡ æ¯ç§æ¨¡å¼éƒ½æœ‰ç‹¬ç‰¹çš„ä¹è¶£ï¼Œå¿«æ¥è¯•è¯•å§ï¼')
            .fontSize(12)
            .fontColor($r('app.color.primary_brand'))
            .fontStyle(FontStyle.Italic)
            .margin({ top: 30, bottom: 20 })
            .opacity(this.isPageLoaded ? 0.8 : 0)
            .animation({ duration: 400, delay: 800 })
        }
        .width('100%')
        .padding({ left: 16, right: 16 })
      }
      .layoutWeight(1)
      .edgeEffect(EdgeEffect.Spring)
    }
    .width('100%')
    .height('100%')
    .backgroundImage($r('app.media.english_bg'))
    .backgroundImageSize(ImageSize.Cover)
  }

  @Builder
  GameModeCard(mode: GameMode, index: number) {
    Column() {
      // å¡ç‰‡å¤´éƒ¨ - å›¾æ ‡å’Œæ ‡é¢˜
      Row() {
        Text(mode.icon)
          .fontSize(32)
          .margin({ right: 12 })
        
        Column() {
          Text(mode.title)
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor($r('app.color.text_primary'))
            .alignSelf(ItemAlign.Start)
          
          Text(mode.difficulty)
            .fontSize(12)
            .fontColor($r('app.color.text_tertiary'))
            .margin({ top: 4 })
            .alignSelf(ItemAlign.Start)
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)
      }
      .width('100%')
      .margin({ bottom: 12 })

      // æè¿°
      Text(mode.description)
        .fontSize(14)
        .fontColor($r('app.color.text_secondary'))
        .lineHeight(22)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })

      // å¼€å§‹æŒ‰é’®
      Button('å¼€å§‹æŒ‘æˆ˜')
        .width('100%')
        .height(44)
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .backgroundColor(mode.color)
        .fontColor('#FFFFFF')
        .borderRadius(22)
        .margin({ top: 16 })
        .onClick(() => {
          this.selectedMode = mode.id;
          animateTo({ duration: 200 }, () => {
            router.push({ url: mode.route });
          });
        })
    }
    .width('100%')
    .padding(20)
    .backgroundColor($r('app.color.card_background'))
    .borderRadius(16)
    .margin({ top: index === 0 ? 0 : 16 })
    .shadow({
      radius: 12,
      color: 'rgba(0, 0, 0, 0.1)',
      offsetX: 0,
      offsetY: 4
    })
    .scale({ 
      x: this.selectedMode === mode.id ? 0.98 : 1,
      y: this.selectedMode === mode.id ? 0.98 : 1
    })
    .opacity(this.isPageLoaded ? 1 : 0)
    .translate({ y: this.isPageLoaded ? 0 : 30 })
    .animation({
      duration: 500,
      delay: 200 + index * 100,
      curve: Curve.EaseOut
    })
  }
}