import router from '@ohos.router';

interface ChineseItem {
  id: number;
  title: string;
  icon: string;
  description: string;
  color: ResourceColor;
  bgGradient: [ResourceColor, number][];
  count: number;
}

// å®šä¹‰è¯—è¯åˆ†ç±»ä¸»é¢˜æ¥å£
interface FeihuaTheme {
  id: number;
  name: string;
  description: string;
  icon: string;
  keyword: string;
}

// å®šä¹‰åˆ†ç»„ä¸»é¢˜æ¥å£
interface GroupedTheme {
  category: string;
  themes: FeihuaTheme[];
}

@Component
export struct ChinesePage {
  @State selectedItem: number = 1; // é»˜è®¤é€‰ä¸­å”è¯—é‰´èµ
  @State isPageLoaded: boolean = false;
  @State isNavigating: boolean = false; // é˜²æ­¢å¤šæ¬¡ç‚¹å‡»è·³è½¬çš„çŠ¶æ€
  @State gridColumns: string = '1fr 1fr'; // é»˜è®¤ç½‘æ ¼åˆ—æ•°
  @State searchKeyword: string = ''; // æœç´¢å…³é”®è¯
  @State isSearching: boolean = false; // æ˜¯å¦æ­£åœ¨æœç´¢
  @State stickyHeaderVisible: boolean = false; // å¸é¡¶åŒºåŸŸæ˜¯å¦å¯è§
  @State showTopHeader: boolean = true; // é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸæ˜¯å¦å¯è§
  
  // å®šä¹‰è¯­æ–‡å­¦ä¹ é¡¹ç›®åˆ—è¡¨
  private chineseItems: Array<ChineseItem> = [
    { 
      id: 1, 
      title: 'å”è¯—é‰´èµ', 
      icon: 'ğŸ“–', 
      description: 'åƒå¤ç»å”±,è¯—éŸµæ‚ æ‰¬',
      color: $r('app.color.tang_poem_card'),
      bgGradient: [[$r('app.color.tang_poem_card'), 1.0], [$r('app.color.tang_poem_card_light'), 1.0]],
      count: 110
    },
    { 
      id: 2, 
      title: 'å®‹è¯ç²¾é€‰',
      icon: 'ğŸµ', 
      description: 'å©‰çº¦è±ªæ”¾,è¯éŸµæ‚ é•¿',
      color: $r('app.color.song_lyric_card'),
      bgGradient: [[$r('app.color.song_lyric_card'), 1.0], [$r('app.color.song_lyric_card_light'), 1.0]],
      count: 100
    },
    { 
      id: 3, 
      title: 'å…ƒæ›²èµæ', 
      icon: 'ğŸª', 
      description: 'æ›²éŸµæ‚ æ‰¬,æ„å¢ƒæ·±è¿œ',
      color: $r('app.color.yuan_opera_card'),
      bgGradient: [[$r('app.color.yuan_opera_card'), 1.0], [$r('app.color.yuan_opera_card_light'), 1.0]],
      count: 100
    }
  ];
  
  // è¯—è¯åˆ†ç±»ä¸»é¢˜åˆ†ç±»åˆ—è¡¨
  private themes: FeihuaTheme[] = [
    { id: 1, name: 'å†™æ™¯', description: 'å±±æ°´é£å…‰', icon: 'ğŸï¸', keyword: 'å±±|æ°´|æ±Ÿ|æ¹–' },
    { id: 2, name: 'å†™èŠ±', description: 'ç™¾èŠ±é½æ”¾', icon: 'ğŸŒ¸', keyword: 'èŠ±|æ¢…|èŠ|è²' },
    { id: 3, name: 'å†™è¾¹å¡', description: 'é“é©¬é‡‘æˆˆ', icon: 'âš”ï¸', keyword: 'å¡|å…³|æˆ˜|å¾' },
    { id: 4, name: 'å†™çˆ±æƒ…', description: 'ç›¸æ€ç»µç»µ', icon: 'ğŸ’•', keyword: 'çˆ±|æƒ…|æ€|ç›¸æ€' },
    { id: 5, name: 'å†™æ€ä¹¡', description: 'ä¸¾å¤´æœ›æœˆ', icon: 'ğŸ ', keyword: 'ä¹¡|å½’|å®¶|æ•…ä¹¡' },
    { id: 6, name: 'å†™ç”°å›­', description: 'é˜¡é™Œçºµæ¨ª', icon: 'ğŸŒ¾', keyword: 'ç”°|å›­|å†œ|è€•' },
    { id: 7, name: 'å†™ç¦»åˆ«', description: 'ä¾ä¾æƒœåˆ«', icon: 'ğŸ‘‹', keyword: 'åˆ«|ç¦»|é€|è¡Œ' },
    { id: 8, name: 'å†™å­¤ç‹¬', description: 'ç‹¬åå¹½ç¯', icon: 'ğŸ˜”', keyword: 'å­¤|ç‹¬|å¯‚|å¯' },
    { id: 9, name: 'å†™å£®å¿—', description: 'è±ªæƒ…ä¸‡ä¸ˆ', icon: 'ğŸ¦…', keyword: 'å¿—|é›„|å£®|è±ª' },
    { id: 10, name: 'å†™èŒ¶', description: 'æ¸…èŒ—é£˜é¦™', icon: 'ğŸµ', keyword: 'èŒ¶|èŒ—|æ³‰|ç…®' },
    { id: 11, name: 'å’ç‰©', description: 'å’ç‰©æŠ’æ€€', icon: 'ğŸ“¿', keyword: 'ç‰©|å™¨|å®|ç‰' },
    { id: 12, name: 'æ˜¥å¤©', description: 'æ˜¥æ„ç›ç„¶', icon: 'ğŸŒ±', keyword: 'æ˜¥|ç»¿|æš–|ç”Ÿ' },
    { id: 13, name: 'å¤å¤©', description: 'å¤æ—¥ç‚ç‚', icon: 'â˜€ï¸', keyword: 'å¤|çƒ­|è·|è‰' },
    { id: 14, name: 'ç§‹å¤©', description: 'ç§‹é«˜æ°”çˆ½', icon: 'ğŸ‚', keyword: 'ç§‹|é»„|éœœ|è½' },
    { id: 15, name: 'å†¬å¤©', description: 'å¯’å†¬è…Šæœˆ', icon: 'â„ï¸', keyword: 'å†¬|é›ª|å¯’|å†°' },
    { id: 16, name: 'å†™é›¨', description: 'çƒŸé›¨è’™è’™', icon: 'ğŸŒ§ï¸', keyword: 'é›¨|æ¹¿|æ¶¦|æ»´' },
    { id: 17, name: 'å†™é›ª', description: 'é›ªèŠ±é£˜é£˜', icon: 'â›„', keyword: 'é›ª|ç™½|å†·|å†»' },
    { id: 18, name: 'å†™é£', description: 'æ¸…é£å¾æ¥', icon: 'ğŸŒ¬ï¸', keyword: 'é£|å¹|æ‹‚|é£˜' },
    { id: 19, name: 'å†™æ¢…èŠ±', description: 'å‚²é›ªå¯’æ¢…', icon: 'ğŸŒº', keyword: 'æ¢…|é¦™|å¯’|å‚²' },
    { id: 20, name: 'å†™è·èŠ±', description: 'è·å¡˜æœˆè‰²', icon: 'ğŸª·', keyword: 'è·|è²|æ± |å¡˜' },
    { id: 21, name: 'å†™èŠèŠ±', description: 'é‡‘ç§‹èŠéŸµ', icon: 'ğŸŒ»', keyword: 'èŠ|é»„|ç§‹|é¦™' },
    { id: 22, name: 'å†™æŸ³æ ‘', description: 'æ¨æŸ³ä¾ä¾', icon: 'ğŸŒ¿', keyword: 'æŸ³|ç»¿|å‚|æ¡' },
    { id: 23, name: 'æœˆäº®', description: 'æ˜æœˆæ¸…è¾‰', icon: 'ğŸŒ•', keyword: 'æœˆ|æ˜|è¾‰|åœ†' },
    { id: 24, name: 'å±±æ°´', description: 'å±±æ¸…æ°´ç§€', icon: 'â›°ï¸', keyword: 'å±±|æ°´|å³°|æºª' },
    { id: 25, name: 'å†™å±±', description: 'å·å³¨é«˜å±±', icon: 'ğŸ”ï¸', keyword: 'å±±|å³°|å²­|å²³' },
    { id: 26, name: 'å†™æ°´', description: 'æ±Ÿæ²³æ¹–æµ·', icon: 'ğŸ’§', keyword: 'æ°´|æ±Ÿ|æ²³|æ¹–' },
    { id: 27, name: 'é•¿æ±Ÿ', description: 'é•¿æ±Ÿæµ©è¡', icon: 'ğŸŒŠ', keyword: 'æ±Ÿ|é•¿|æµ|æµª' },
    { id: 28, name: 'é»„æ²³', description: 'é»„æ²³å¥”è…¾', icon: 'ğŸï¸', keyword: 'æ²³|é»„|æµª|æ¶›' },
    { id: 29, name: 'å„¿ç«¥', description: 'ç«¥çœŸç«¥è¶£', icon: 'ğŸ‘¶', keyword: 'ç«¥|å„¿|å°|å¹¼' },
    { id: 30, name: 'å†™é¸Ÿ', description: 'é£é¸Ÿç¿±ç¿”', icon: 'ğŸ¦', keyword: 'é¸Ÿ|é›|é¹¤|ç‡•' },
    { id: 31, name: 'å†™é©¬', description: 'éªé©¬å¥”è…¾', icon: 'ğŸ', keyword: 'é©¬|éª‘|é©°|å¥”' },
    { id: 32, name: 'åœ°å', description: 'åèƒœå¤è¿¹', icon: 'ğŸ—ºï¸', keyword: 'åœ°|åŸ|å…³|å·' },
    { id: 33, name: 'èŠ‚æ—¥', description: 'ä¼ ç»Ÿä½³èŠ‚', icon: 'ğŸŠ', keyword: 'èŠ‚|æ—¥|åº†|æ¬¢' },
    { id: 34, name: 'æ˜¥èŠ‚', description: 'æ–°æ˜¥ä½³èŠ‚', icon: 'ğŸ§§', keyword: 'æ˜¥|å²|å¹´|æ–°' },
    { id: 35, name: 'å…ƒå®µ', description: 'å…ƒå®µä½³èŠ‚', icon: 'ğŸ®', keyword: 'ç¯|å…ƒ|å®µ|åœ†' },
    { id: 36, name: 'å¯’é£Ÿ', description: 'å¯’é£Ÿæ¸…æ˜', icon: 'ğŸ•¯ï¸', keyword: 'å¯’|é£Ÿ|ç«|çƒŸ' },
    { id: 37, name: 'æ¸…æ˜', description: 'æ¸…æ˜æ—¶èŠ‚', icon: 'ğŸŒ§ï¸', keyword: 'æ¸…|æ˜|é›¨|ç¥­' },
    { id: 38, name: 'ç«¯åˆ', description: 'ç«¯åˆé¾™èˆŸ', icon: 'ğŸ²', keyword: 'ç«¯|åˆ|ç²½|èˆŸ' },
    { id: 39, name: 'ä¸ƒå¤•', description: 'ä¸ƒå¤•é¹Šæ¡¥', icon: 'ğŸ’«', keyword: 'ä¸ƒ|å¤•|æ˜Ÿ|æ¡¥' },
    { id: 40, name: 'ä¸­ç§‹', description: 'ä¸­ç§‹æœˆåœ†', icon: 'ğŸ¥®', keyword: 'ä¸­|ç§‹|æœˆ|åœ†' },
    { id: 41, name: 'é‡é˜³', description: 'é‡é˜³ç™»é«˜', icon: 'ğŸ”ï¸', keyword: 'é‡|é˜³|èŠ|ç™»' },
    { id: 42, name: 'æ€€å¤', description: 'æ€€å¤å¹½æ€', icon: 'ğŸ›ï¸', keyword: 'å¤|æ˜”|å²|è¿¹' },
    { id: 43, name: 'æŠ’æƒ…', description: 'æŠ’æƒ…è¨€å¿—', icon: 'ğŸ’­', keyword: 'æƒ…|å¿—|æ„|æ€€' },
    { id: 44, name: 'çˆ±å›½', description: 'æŠ¥å›½æƒ…æ€€', icon: 'ğŸ‡¨ğŸ‡³', keyword: 'å›½|å¿ |æŠ¥|å¿—' },
    { id: 45, name: 'é€åˆ«', description: 'ä¾ä¾æƒœåˆ«', icon: 'ğŸ¤', keyword: 'é€|åˆ«|ç¦»|å»' },
    { id: 46, name: 'é—ºæ€¨', description: 'é—ºé˜å¹½æ€¨', icon: 'ğŸŒ¸', keyword: 'é—º|æ€¨|æ€|æ„' },
    { id: 47, name: 'æ‚¼äº¡', description: 'æ‚¼å¿µäº¡è€…', icon: 'ğŸ•Šï¸', keyword: 'æ‚¼|äº¡|é€|å¿†' },
    { id: 48, name: 'è€å¸ˆ', description: 'å¸ˆæ©éš¾å¿˜', icon: 'ğŸ“š', keyword: 'å¸ˆ|æ•™|å­¦|é“' },
    { id: 49, name: 'å‹æƒ…', description: 'çŸ¥å·±è‰¯æœ‹', icon: 'ğŸ¤', keyword: 'å‹|æœ‹|çŸ¥|äº¤' },
    { id: 50, name: 'å“²ç†', description: 'äººç”Ÿå“²ç†', icon: 'â˜¯ï¸', keyword: 'ç†|é“|æ‚Ÿ|æ€' },
    { id: 51, name: 'è¯»ä¹¦', description: 'å‹¤å­¦è‹¦è¯»', icon: 'ğŸ“–', keyword: 'ä¹¦|è¯»|å­¦|æ–‡' },
  /*  { id: 52, name: 'å©‰çº¦', description: 'å©‰çº¦æŸ”ç¾', icon: 'ğŸ­', keyword: 'å©‰|æŸ”|ç»†|ç¾' },
    { id: 53, name: 'è±ªæ”¾', description: 'è±ªæ”¾ä¸ç¾', icon: 'ğŸº', keyword: 'è±ª|æ”¾|å£®|é˜”' },
    { id: 54, name: 'æ°‘è°£', description: 'æ°‘é—´æ­Œè°£', icon: 'ğŸµ', keyword: 'è°£|æ­Œ|æ°‘|æ›²' },
    { id: 55, name: 'æ¯äº²', description: 'æ…ˆæ¯æƒ…æ·±', icon: 'ğŸ‘©', keyword: 'æ¯|æ…ˆ|æ©|å…»' }
  */];

  // æŒ‰ç±»åˆ«åˆ†ç»„çš„ä¸»é¢˜æ•°æ®
  private groupedThemes: GroupedTheme[] = [
    {
      category: 'æƒ…æ„Ÿè¡¨è¾¾',
      themes: this.themes.slice(0, 10)
    },
    {
      category: 'è‡ªç„¶æ™¯ç‰©',
      themes: this.themes.slice(10, 25)
    },
    {
      category: 'æ—¶èŠ‚èŠ‚æ—¥',
      themes: this.themes.slice(25, 40)
    },
    {
      category: 'äººç‰©å…³ç³»',
      themes: this.themes.slice(40, 51)
    }
  ];

  aboutToAppear(): void {
    // é¡µé¢åŠ è½½åŠ¨ç”»
    setTimeout(() => {
      this.isPageLoaded = true;
    }, 300);
  }

  // æ ¹æ®IDè·³è½¬åˆ°å¯¹åº”é¡µé¢
  navigateToPage(id: number) {
    // å¦‚æœæ­£åœ¨è·³è½¬ä¸­ï¼Œåˆ™å¿½ç•¥åç»­ç‚¹å‡»
    if (this.isNavigating) {
      return;
    }
    
    // å…ˆæ›´æ–°é€‰ä¸­çŠ¶æ€ï¼Œæ˜¾ç¤ºæ”¾å¤§æ•ˆæœ
    this.selectedItem = id;
    this.isNavigating = true; // è®¾ç½®æ­£åœ¨è·³è½¬çŠ¶æ€
    
    // å»¶è¿Ÿä¸€æ®µæ—¶é—´åè·³è½¬ï¼Œç¡®ä¿æ”¾å¤§åŠ¨ç”»å®Œå…¨æ’­æ”¾å®Œæ¯•åå†è·³è½¬
    setTimeout(() => {
      switch (id) {
        case 1:
          router.push({ url: 'pages/chinese/PoemsListPage' });
          break;
        case 2:
          router.push({ url: 'pages/chinese/SongsListPage' });
          break;
        case 3:
          router.push({ url: 'pages/chinese/YuanquListPage' });
          break;
        default:
          console.log('æœªçŸ¥çš„é¡µé¢ID:', id);
      }
      // åœ¨è·³è½¬å‘½ä»¤æ‰§è¡Œåç«‹å³é‡ç½®çŠ¶æ€
      this.isNavigating = false;
    }, 1000);
  }

  // è·å–è¿‡æ»¤åçš„ä¸»é¢˜æ•°æ®
  getFilteredThemes(): GroupedTheme[] {
    // å¦‚æœæ²¡æœ‰æœç´¢å…³é”®è¯ï¼Œè¿”å›æ‰€æœ‰ä¸»é¢˜
    if (!this.isSearching || this.searchKeyword.trim().length === 0) {
      return this.groupedThemes;
    }
    
    // åˆ›å»ºæ–°çš„è¿‡æ»¤ç»“æœæ•°ç»„
    const filteredGroups: GroupedTheme[] = [];
    
    // éå†æ‰€æœ‰åˆ†ç»„
    for (let i = 0; i < this.groupedThemes.length; i++) {
      const group = this.groupedThemes[i];
      // è¿‡æ»¤å½“å‰åˆ†ç»„ä¸­çš„ä¸»é¢˜
      const filteredThemes = group.themes.filter(theme => {
        // æ£€æŸ¥ä¸»é¢˜åç§°ã€æè¿°æˆ–å…³é”®å­—æ˜¯å¦åŒ…å«æœç´¢å…³é”®è¯ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
        return (
          theme.name.toLowerCase().includes(this.searchKeyword.toLowerCase()) ||
          theme.description.toLowerCase().includes(this.searchKeyword.toLowerCase()) ||
          theme.keyword.toLowerCase().includes(this.searchKeyword.toLowerCase())
        );
      });
      
      // å¦‚æœè¿‡æ»¤åè¿˜æœ‰ä¸»é¢˜ï¼Œåˆ™æ·»åŠ åˆ°ç»“æœä¸­
      if (filteredThemes.length > 0) {
        filteredGroups.push({
          category: group.category,
          themes: filteredThemes
        });
      }
    }
    
    return filteredGroups;
  }

  build() {
    Scroll() {
      Column() {
        // é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ
        Column() {
          Text('è¯—åŒ£')
            .fontSize(32)
            .fontWeight(FontWeight.Bold)
            .fontColor($r('app.color.accent_positive'))
            .textShadow({ radius: 2, color: $r('app.color.text_tertiary'), offsetX: 0, offsetY: 2 })
            .margin({ bottom: 6 })
            .scale({ x: this.isPageLoaded ? 1 : 0.8, y: this.isPageLoaded ? 1 : 0.8 })
            .opacity(this.isPageLoaded ? 1 : 0)
            .animation({ duration: 600, curve: Curve.EaseOut })

          Text('å¼€å¯å¤å…¸æ–‡å­¦ä¹‹æ—…')
            .fontSize(14)
            .fontColor($r('app.color.text_secondary'))
            .fontWeight(FontWeight.Medium)
            .opacity(this.isPageLoaded ? 1 : 0)
            .animation({ duration: 600, curve: Curve.EaseOut, delay: 100 })
        }
        .margin({ top: 30, bottom: 20 })
        .alignItems(HorizontalAlign.Center)

        // è¯—åŒ£å®¹å™¨ - æ”¯æŒæ»‘åŠ¨
        Column() {
          Scroll() {
            Row() {
              ForEach(this.chineseItems, (item: ChineseItem, index: number) => {
                this.MagicBox(item, index)
              })
            }
            .justifyContent(FlexAlign.Start)
            .width('auto')
            .padding({ left: 30, right: 30 })
          }
          .scrollable(ScrollDirection.Horizontal)
          .scrollBar(BarState.Off)
          .width('100%')
          .height(120)
          .margin({ bottom: 10 })

          // è¯—åŒ£æŒ‡ç¤ºå™¨
          Row() {
            ForEach(this.chineseItems, (item: ChineseItem, index: number) => {
              Circle({ width: 6, height: 6 })
                .fill(item.id === this.selectedItem ? item.color : $r('app.color.text_tertiary'))
                .margin({ right: 5 })
                .scale({ x: item.id === this.selectedItem ? 1.2 : 1, y: item.id === this.selectedItem ? 1.2 : 1 })
                .animation({ duration: 300, curve: Curve.EaseInOut })
            })
          }
          .margin({ bottom: 20 })
        }

        // å¸é¡¶åŒºåŸŸ - è¯—è¯åˆ†ç±»æ ‡é¢˜å’Œæœç´¢æ¡†
        Column() {
          // åˆ†éš”çº¿å’Œè‘—åè¯—äººæ ‡é¢˜
          Column() {
            Row()
              .width('80%')
              .height(1)
              .backgroundColor($r('app.color.text_tertiary'))
              .opacity(0.3)
              .margin({ bottom: 10 })
            
            Row() {
              Text('ğŸŒ¸')
                .fontSize(20)
                .margin({ right: 8 })
              
              Text('è¯—è¯åˆ†ç±»')
                .fontSize(20)
                .fontWeight(FontWeight.Bold)
                .fontColor($r('app.color.text_primary'))
              
              Text('ğŸŒ¸')
                .fontSize(20)
                .margin({ left: 8 })
            }
            .margin({ bottom: 10 })
          }
          .alignItems(HorizontalAlign.Center)
          .margin({ top: 5 })

          // æœç´¢æ¡†
          Row() {
            TextInput({ 
              placeholder: 'æœç´¢è¯—è¯åˆ†ç±»...', 
              text: this.searchKeyword 
            })
            .onChange((value: string) => {
              this.searchKeyword = value;
              this.isSearching = value.length > 0;
            })
            .placeholderColor($r('app.color.text_secondary'))
            .width('80%')
            .height(40)
            .borderRadius(20)
            .backgroundColor($r('app.color.card_background'))
            .padding({ left: 15, right: 15 })
            .margin({ bottom: 10 })
            
            // æ¸…é™¤æŒ‰é’®
            if (this.isSearching) {
              Button('æ¸…é™¤')
                .width(60)
                .height(40)
                .fontSize(14)
                .borderRadius(20)
                .backgroundColor($r('app.color.card_background'))  // ä½¿ç”¨å·²æœ‰çš„é¢œè‰²èµ„æº
                .fontColor($r('app.color.text_primary'))
                .onClick(() => {
                  this.searchKeyword = '';
                  this.isSearching = false;
                })
                .margin({ left: 10 })
            }
          }
          .width('100%')
          .justifyContent(FlexAlign.Center)
        }
        .height(130)
        .id('stickyHeader')
        .backgroundColor($r('app.color.page_background'))
        .constraintSize({ minHeight: 130 })

        // è¯—è¯åˆ†ç±»å±•ç¤ºåŒºåŸŸ
        Column() {
          // æ”¹è¿›çš„è¯—è¯åˆ†ç±»å±•ç¤º - ç½‘æ ¼å¸ƒå±€åˆ†ç»„å±•ç¤º
          Column() {
            // è¿‡æ»¤åçš„ä¸»é¢˜æ•°æ®
            ForEach(this.getFilteredThemes(), (group: GroupedTheme, groupIndex: number) => {
              Column() {
                // åˆ†ç»„æ ‡é¢˜
                Row() {
                  Text(group.category)
                    .fontSize(18)
                    .fontWeight(FontWeight.Bold)
                    .fontColor($r('app.color.text_primary'))
                    .layoutWeight(1)
                }
                .padding({ left: 20, right: 20, top: 10, bottom: 10 })

                // åˆ†ç»„å†…å®¹ - ç½‘æ ¼å¸ƒå±€
                Grid() {
                  ForEach(group.themes, (theme: FeihuaTheme, index: number) => {
                    GridItem() {
                      this.ThemeCard(theme, index)
                    }
                  }, (theme: FeihuaTheme) => theme.id.toString())
                }
                .columnsTemplate(this.gridColumns) // ä½¿ç”¨çŠ¶æ€å˜é‡æ§åˆ¶åˆ—æ•°
                .rowsGap(10)
                .columnsGap(10)
                .padding({ left: 20, right: 20 })
                // å“åº”å¼å¸ƒå±€ - æ ¹æ®å±å¹•å®½åº¦è°ƒæ•´åˆ—æ•°
                .onAreaChange((oldArea, newArea) => {
                  // å°†Lengthç±»å‹è½¬æ¢ä¸ºnumberç±»å‹
                  const widthStr: string = newArea.width.toString();
                  const width: number = parseInt(widthStr, 10) || 0;
                  
                  if (width > 700) {
                    // å¤§å±å¹•æ˜¾ç¤º4åˆ—
                    this.gridColumns = '1fr 1fr 1fr 1fr';
                  } else if (width > 500) {
                    // ä¸­ç­‰å±å¹•æ˜¾ç¤º3åˆ—
                    this.gridColumns = '1fr 1fr 1fr';
                  } else {
                    // å°å±å¹•æ˜¾ç¤º2åˆ—
                    this.gridColumns = '1fr 1fr';
                  }
                })
              }
            })
          }
          .padding({ bottom: 20 })
        }
      }
      .width('100%')
    }
    .scrollable(ScrollDirection.Vertical)
    .scrollBar(BarState.Off)
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.page_background'))
  }

  @Builder
  MagicBox(item: ChineseItem, index: number) {
    Column() {
      // åŒ£å­å›¾æ ‡
      Text(item.icon)
        .fontSize(item.id === this.selectedItem ? 32 : 30)
        .margin({ top: item.id === this.selectedItem ? 6 : 4, bottom: item.id === this.selectedItem ? 4 : 2 })
        .scale({ x: item.id === this.selectedItem ? 1.1 : 1, y: item.id === this.selectedItem ? 1.1 : 1 })
        .animation({ duration: 300, curve: Curve.EaseInOut })
      
      // åŒ£å­æ ‡é¢˜
      Text(item.title)
        .fontSize(item.id === this.selectedItem ? 12: 11)
        .fontWeight(FontWeight.Bold)
        .fontColor($r('app.color.text_primary'))
        .margin({ bottom: item.id === this.selectedItem ? 2 : 1 })
        .scale({ x: item.id === this.selectedItem ? 1.05 : 1, y: item.id === this.selectedItem ? 1.05 : 1 })
        .animation({ duration: 300, curve: Curve.EaseInOut })
        .maxLines(1)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
      
      // åŒ£å­æè¿°
      Text(item.description)
        .fontSize(10)
        .fontColor($r('app.color.text_primary'))
        .opacity(0.9)
        .margin({ bottom: item.id === this.selectedItem ? 4 : 2 })
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .textAlign(TextAlign.Center)
      
      // æ”¶è—æ•°é‡
      Text(`${item.count}+`)
        .fontSize(9)
        .fontWeight(FontWeight.Medium)
        .fontColor($r('app.color.text_primary'))
        .opacity(0.8)
    }
    .width(item.id === this.selectedItem ? 140 : 125)
    .height(item.id === this.selectedItem ? 100 : 90)
    .borderRadius(18)
    .padding({ top: 10, bottom: 10, left: 12, right: 12 })  // å¢åŠ å‚ç›´å†…è¾¹è·ä½¿å†…å®¹æ›´å±…ä¸­
    .linearGradient({
      direction: GradientDirection.Bottom,
      colors: item.bgGradient
    })
    .shadow({
      radius: item.id === this.selectedItem ? 18 : 10,
      color: item.id === this.selectedItem ? $r('app.color.text_tertiary') : $r('app.color.text_secondary'),
      offsetX: 0,
      offsetY: item.id === this.selectedItem ? 7 : 4
    })
    .scale({ x: item.id === this.selectedItem ? 1.05 : 1, y: item.id === this.selectedItem ? 1.05 : 1 })
    .onClick(() => {
      animateTo({
        duration: 100,
        curve: Curve.EaseInOut
      }, () => {
        // ç‚¹å‡»æ—¶çš„ç¼©æ”¾æ•ˆæœ
      })
      
      this.navigateToPage(item.id);
    })
    .margin({ left: index === 0 ? 0 : 12, right: index === 2 ? 0 : 12 })
    .translate({
      y: this.isPageLoaded ? 0 : 30,
      x: this.isPageLoaded ? 0 : (index === 0 ? -50 : (index === 2 ? 50 : 0))
    })
    .opacity(this.isPageLoaded ? 1 : 0)
    .animation({
      duration: 600,
      curve: Curve.EaseOut,
      delay: 200 + index * 100
    })
    .justifyContent(FlexAlign.Center)  // æ•´ä½“å†…å®¹å±…ä¸­
  }

  @Builder
  ThemeCard(theme: FeihuaTheme, index: number) {
    Column() {
      // ä¸»é¢˜å›¾æ ‡
      Text(theme.icon)
        .fontSize(32)
        .margin({ bottom: 10 })
      
      // ä¸»é¢˜åç§°
      Text(theme.name)
        .fontSize(15)
        .fontWeight(FontWeight.Bold)
        .fontColor($r('app.color.text_primary'))
        .margin({ bottom: 5 })
        .maxLines(1)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
      
      // ä¸»é¢˜æè¿°
      Text(theme.description)
        .fontSize(11)
        .fontColor($r('app.color.text_secondary'))
        .opacity(0.8)
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .textAlign(TextAlign.Center)
    }
    .width('100%')
    .height(110)
    .backgroundColor($r('app.color.card_background'))
    .borderRadius(10)
    .padding({ top: 10, bottom: 10, left: 10, right: 10 })
    .justifyContent(FlexAlign.Center)
    .shadow({
      radius: 5,
      color: $r('app.color.text_tertiary'),
      offsetX: 0,
      offsetY: 1
    })
    .onClick(() => {
      // è·³è½¬åˆ°ä¸»é¢˜è¯—è¯åˆ—è¡¨é¡µ
      router.pushUrl({
        url: 'pages/chinese/ThemePoemsPage',
        params: {
          themeId: theme.id,
          themeName: theme.name
        }
      });
    })
    .scale({ x: this.isPageLoaded ? 1 : 0.8, y: this.isPageLoaded ? 1 : 0.8 })
    .opacity(this.isPageLoaded ? 1 : 0)
    .animation({
      duration: 400,
      curve: Curve.EaseOut,
      delay: 400 + index * 60
    })
  }
}